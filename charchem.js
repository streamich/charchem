/*! CharChem.js ver 1.0
 * 2015-08-07 by PeterWin
 */
function Point(d,c){if(d===undefined){return this.x=this.y=0}if(typeof d=="object"&&("x" in d)&&("y" in d)){this.x=+d.x;this.y=+d.y}else{this.x=+d;if(isNaN(this.y=+c)){this.y=this.x}}if(isNaN(this.x)||isNaN(this.y)){this.x=this.y=0}}function Rect(d,c){this.A=d||new Point();this.B=c||new Point()}function is0(b){return Math.abs(b)<0.001}function esc(b){return(typeof b=="string")?b.replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}Point.prototype=new function(){function c(e,d){if(e instanceof Point){return e}return new Point(e,d)}this.init=function(d,e){this.x=d;this.y=e};this.from=function(d){this.x=d.x;this.y=d.y;return this};this.equals=function(e,d){var f=c(e,d);return is0(this.x-f.x)&&is0(this.y-f.y)};this.addi=function(e,d){var f=c(e,d);this.x+=f.x;this.y+=f.y;return this};this.addx=function(e,d){var f=new Point(e,d);f.x+=this.x;f.y+=this.y;return f};this.subi=function(e,d){var f=c(e,d);this.x-=f.x;this.y-=f.y;return this};this.subx=function(e,d){var f=new Point(e,d);return f.negi().addi(this)};this.mini=function(e,d){var f=c(e,d);this.x=Math.min(this.x,f.x);this.y=Math.min(this.y,f.y)};this.maxi=function(e,d){var f=c(e,d);this.x=Math.max(this.x,f.x);this.y=Math.max(this.y,f.y)};this.negi=function(){this.x=-this.x;this.y=-this.y;return this};this.negx=function(){return new Point(this).negi()};this.muli=function(d){this.x*=d;this.y*=d;return this};this.mulx=function(d){return this.clone().muli(d)};this.lengthSqr=function(){return this.x*this.x+this.y*this.y};this.length=function(){return Math.sqrt(this.lengthSqr())};this.distSqr=function(e,d){return this.subx(c(e,d)).lengthSqr()};this.dist=function(e,d){return Math.sqrt(this.distSqr(e,d))};this.fromRad=function(d){this.x=Math.cos(d);this.y=Math.sin(d);return this};this.fromDeg=function(d){return this.fromRad(Math.PI*d/180)};this.transponi=function(){var d=this.x;this.x=this.y;this.y=d;return this};this.transponx=function(){return this.clone().transponi()};this.dotProduct=function(d){return this.x*d.x+this.y*d.y};function b(d){d=Math.round(d*1000)/1000;return d.toString()}this.toString=function(){return"{"+b(this.x)+", "+b(this.y)+"}"};this.clone=function(){return new Point(this)};this.polarAngle=function(){if(this.x==0&&this.y==0){return 0}if(this.x==0){return this.y>0?Math.PI/2:Math.PI*3/2}return Math.atan2(this.y,this.x)}};Rect.prototype={clone:function(){return new Rect(this.A.clone(),this.B.clone())},init:function(b){this.A=b.A.clone();this.B=b.B.clone()},initN:function(e,c,d,b){this.A.init(e,c);this.B.init(d,b)},LT:function(b){if(b){this.A=b}return this.A},RB:function(c){if(c){this.B=c}return this.B},RT:function(){return new Point(this.B.x,this.A.y)},LB:function(){return new Point(this.A.x,this.B.y)},minLT:function(b){this.A.mini(b)},maxRB:function(b){this.B.maxi(b)},L:function(){return this.A.x},R:function(){return this.B.x},T:function(){return this.A.y},Bot:function(){return this.B.y},W:function(){return this.B.x-this.A.x},H:function(){return this.B.y-this.A.y},size:function(){return this.B.subx(this.A)},center:function(){return this.A.addx(this.B).muli(0.5)},cx:function(){return(this.A.x+this.B.x)/2},cy:function(){return(this.A.y+this.B.y)/2},is0:function(){return this.A.equals(this.B)},move:function(b){this.A.addi(b);this.B.addi(b)},grow:function(d,f){if(typeof d=="object"&&("x" in d)&&("y" in d)){f=d.y;d=d.x}else{if(f===undefined){f=d}}var e=this.A,c=this.B;e.x-=d;e.y-=f;c.x+=d;c.y+=f},unite:function(b){if(this.is0()){this.A=b.LT().clone();this.B=b.RB().clone()}else{this.A.mini(b.LT());this.B.maxi(b.RB())}}};function isAbsK(b){return typeof b!="number"}function massRound(b){return Math.round(b*1000)/1000}var DemoVisitor={entityPre:0,entityPost:0,operation:0,agentPre:0,agentPost:0,nodePre:0,nodePost:0,bond:0,bracketBegin:0,bracketEnd:0,mul:0,mulEnd:0,itemPre:0,itemPost:0,atom:0,custom:0,radical:0,comm:0};function ChemError(b,c){this.msgId=b;this.params=c;this.getMessage=function(){return ChemSys.lang(this.msgId,this.params)};this.message=this.getMessage()}function ChemCharge(){this.tx="";this.val=0;this.bLeft=0;this.bRound=0}ChemCharge.create=function(e){function d(l,g,h){var k=new ChemCharge();k.tx=h||e;k.val=+l;k.bRound=g;return k}if(e){if(e=="*"){return d(0)}var f=e.replace(/–/g,"-"),b=f.length;if(/^-+$/.test(f)){return d(-b)}if(/^\++$/.test(f)){return d(b)}if(/(^|(^[-+]))\d+$/.test(f)){return d(f)}if(/^\d+[-+]$/.test(f)){return d(f.charAt(b-1)+f.substring(0,b-1))}if(f=="+o"){return d(1,1,"+")}if(f=="-o"){return d(-1,1,"-")}var c=ChemSys.RomanNum[f];if(c){return d(c,0,f.toUpperCase())}}return 0};function ChemObj(){this.pA=0;this.pB=0;this.setPos=function(d,c){this.pA=d;this.pB=c}}function ChemExpr(){ChemObj.call(this);this.error=0;this.src0="";this.src="";this.ents=[];this.isOk=function(){return !this.error};this.getMessage=function(){return this.error?this.error.getMessage():null};this.html=function(){return this.text("html")};this.text=function(c){if(this.isLinear()){var b=new TextMaker(ChemSys.getRules(c||"text"));this.walk(b);return b.res()}else{return""}};this.walk=function(g){var f,d,k,b=this.ents,h=g.entityPre,c=g.entityPost;for(d in b){k=b[d];if(h){f=g.entityPre(k)}f=f||k.walk(g);if(c){f=g.entityPost(k)||f}if(f){return f}}};this.getObjSrc=function(b){return this.src.substring(b.pA,b.pB)};this.isLinear=function(){var b=new IsNonText();this.walk(b);return !b.ok}}function ChemOp(b,c,d){ChemObj.call(this);this.srcText=b;this.dstText=c;this.eq=!!d;this.walk=function(e){if(e.operation){e.operation(this)}}}function ChemAgent(){this.nodes=[];this.bonds=[];this.cmds=[];this.n=1;this.part=0;this.walk=function(f){var d,c,e,b=this.cmds;if(f.agentPre){d=f.agentPre(this)}if(d){return d}for(c in b){d=b[c].walk(f);if(d){break}}if(f.agentPost){d=f.agentPost(this)||d}return d};this.setKoeff=function(b){this.n=b}}function ChemBond(){ChemObj.call(this);this.index=null;this.N=1;this.nodes=[0,0];this.pt=0;this.tx="";this.slope=0;this.calcPt=function(){return this.nodes[0].pt.addx(this.pt)};this.other=function(d){var c=0,b=this.nodes;if(b.length==2){for(;c<2;c++){if(b[c]==d){return b[c^1]}}}return 0};this.walk=function(b){if(b.bond){return b.bond(this)}}}function ChemBrBegin(b){ChemObj.call(this);this.tx=b;this.end=0;this.nodes=[0,0];this.bond=0;this.walk=function(c){if(c.bracketBegin){return c.bracketBegin(this)}}}ChemBrBegin.Map={"(":")","[":"]","{(":")}"};function ChemBrEnd(b,c){ChemObj.call(this);this.begin=c;this.tx=b;this.n=1;this.charge=0;this.nodes=[0,0];this.bond=0;this.walk=function(d){if(d.bracketEnd){return d.bracketEnd(this)}}}ChemBrEnd.Lst=")]";function ChemMul(b){ChemObj.call(this);this.n=b;this.walk=function(c){if(c.mul){c.mul(this)}}}function ChemMulEnd(b){ChemObj.call(this);this.beg=b;this.n=b.n;this.walk=function(c){if(c.mulEnd){c.mulEnd(this)}}}function ChemNode(b){this.index=null;this.pt=b||new Point();this.ch=0;this.sc=0;this.bAuto=0;this.fixed=0;this.charge=0;this.items=[];this.bonds=[];this.chargeVal=function(){return this.charge?this.charge.val:0};this.walk=function(f){var e,d=0,c=this.items;if(f.nodePre){e=f.nodePre(this);if(e){return e}}while(d<c.length&&!e){e=c[d++].walk(f)}if(f.nodePost){e=f.nodePost(this)||e}return e}}function ChemNodeItem(b){ChemObj.call(this);this.charge=0;this.n=1;this.obj=b;this.M=0;this.walk=function(d){var c;if(d.itemPre){c=d.itemPre(this);if(c){return c}}c=this.obj.walk(d);if(d.itemPost){c=d.itemPost(this)||c}return c}}function ChemSubObj(){}function ChemAtom(d,c,b){ChemSubObj.call(this);this.n=d;this.id=c;this.M=b;this.walk=function(e){if(e.atom){return e.atom(this)}}}function ChemCustom(b){ChemSubObj.call(this);this.tx=b;this.walk=function(c){if(c.custom){return c.custom(this)}}}function ChemComment(b){ChemSubObj.call(this);this.tx=b;this.walk=function(c){if(c.comm){return c.comm(this)}}}function ChemRadical(c,b){this.label=c;this.items=b;this.walk=function(d){if(d.radical){d.radical(this)}}}var RadicalsMap={};function elemRec(d,b){var c={n:b||1};if(typeof d=="string"){c.id=d;c.elem=ChemSys.findElem(d)}else{if(d.M){c.elem=d;c.id=d.id}else{c.elem=d.elem;c.id=d.id;c.n*=d.n}}c.getKey=function(){return this.elem?this.id:"{"+this.id+"}"};return c}function createElemList(){var c=[];function b(){return c.length}c.charge=0;c.findElem=function(e){if(typeof e=="string"){e=ChemSys.findElem(e)}var d=0,f=b();for(;d<f;d++){if(c[d].elem==e){return d}}return -1};c.findCustom=function(g){var d=0,f=b(),e;for(;d!=f;d++){e=c[d];if(!e.elem&&e.id==g){return d}}return -1};c.findKey=function(e){var d=0,g=b(),f;for(;d!=g;d++){f=c[d];if(f.getKey()==e){return d}}return -1};c.findRec=function(d){if(d.elem){return c.findElem(d.elem)}else{return c.findCustom(d.id)}};c.addElemRec=function(e){var d=c.findRec(e);if(d<0){c.push(e)}else{c[d].n+=e.n}};c.addElem=function(d,e){c.addElemRec(elemRec(d,e))};c.addCustom=function(e,f){var d=elemRec(e,f);d.elem=0;c.addElemRec(d)};c.addList=function(f){var d=0,g=f.length,e;for(;d!=g;d++){c.addElemRec(elemRec(f[d]))}c.charge+=f.charge};c.addRadical=function(d){c.addList(d.items)};c.scale=function(d){if(d!=1){var e=0,f=b();for(;e<f;e++){c[e].n*=d}c.charge*=d}};c.sortByHill=function(){function d(f,e){return f<e?-1:(f>e?1:0)}c.sort(function(f,e){if(!f.elem&&!e.elem){return d(f,e)}if(!f.elem){return 1}if(!e.elem){return -1}var h=f.id,g=e.id;if(h==g){return 0}if(h=="C"){return -1}if(g=="C"){return 1}if(h=="H"){return -1}if(g=="H"){return 1}return d(h,g)})};c.toString=function(){var f="",e=0,h=b(),g;for(;e<h;e++){g=c[e];f+=g.getKey();if(g.n!=1){f+=g.n}}if(c.charge){f+="^";var d=Math.abs(c.charge);if(d!=1){f+=d}f+=(c.charge<0)?"-":"+"}return f};return c}var MenTbl={},MenTblArray=[];var MenTblCategoryBlock={s_block:"H,Na,K,Rb,Cs,Fr",p_block:"B,Al,Ga,In,Tl",d_block:"Sc,Y,Hf,Rf",f_block:"La,Ac"},MenTblCategoryProps={"Alkali-metals":"Li,Na,K,Rb,Cs,Fr","Alkaline-earth-metals":"Be,Mg,Ca,Sr,Ba,Ra",Lanthanides:"La",Actinides:"Ac","Transition-metals":"Sc,Y,Hf,Rf,Cn","Post-transition-metals":"Al,Ga,In,Tl",Metalloids:"B,Si,Ge,Sb","Other-nonmetals":"H,C,P,Se",Halogens:"F,Cl,Br,I,At","Noble-gases":"He,Ne,Ar,Kr,Xe,Rn","Unknown-props":"Mt"},MenTblSubGroup={subgr_a:"H,Ga,In,Tl",subgr_b:"Sc,Y,La,Ac"};var ChemSys=new function(){this.ver=function(){return[1,0,1]};this.verStr=function(){return this.ver().join(".")};this.macros={};this.rulesHtml={AgentK:"<b>*</b>",ItemMass:"<sup>*</sup>",ItemCnt:"<sub>*</sub>",BracketCnt:"<sub>*</sub>",ItemCharge:'<sup class="echem-item-charge">*</sup>',ColorPre:'<span style="color:*">',ColorPost:"</span>",NodeCharge:"<sup>*</sup>",cvtCharge:{"-":"–"},Custom:"<i>*</i>",Radical:"*",Comment:"<em>*</em>",OpComment:'<span class="echem-opcomment">*</span>',Operation:'<span class="echem-op">*</span>',cvtOp:{"-->":'<span class="chem-long-arrow">→</span>',"<==>":'<span class="chem-long-arrow">\u21CC</span>',},MassAndNum:'<span class="echem-mass-and-num">@<br/>*</span>',$InvisibleBond:" ",Mul:"*",MultiK:"*",$MulChar:"∙"};this.rulesBB={AgentK:"[b]*[/b]",ItemMass:"[sup]*[/sup]",ItemCnt:"[sub]*[/sub]",BracketCnt:"[sub]*[/sub]",ItemCharge:"[sup]*[/sup]",ColorPre:"[color=*]",ColorPost:"[/color]",NodeCharge:"[sup]*[/sup]",Custom:"[i]*[/i]",Radical:"*",Comment:"[i]*[/i]",MassAndNum:"[sup]@[/sup][sub]*[/sub]",$InvisibleBond:" ",$MulChar:"∙"};this.rulesText={AgentK:"*",ItemCnt:"*",ItemCharge:"*",NodeCharge:"*",Custom:"*",ColorPre:"",ColorPost:""};this.rulesMhchem={AgentK:"*",ItemMass:"^*",ItemCnt:"_{*}",BracketCnt:"_{*}",ItemCharge:"^{*}",ColorPre:"\\color{*}{",ColorPost:"}",NodeCharge:"^{*}",Custom:"*",Radical:"*",Comment:"*",OpComment:"*",MassAndNum:"^{@}_{*}",$InvisibleBond:" ",Mul:"*",MultiK:"*",$MulChar:"*",Operation:function(e){var d,c=this.cvtOp[e.srcText]||e.srcText;if(d=e.commentPre){c+="["+d.tx+"]"}if(d=e.commentPost){c+="["+d.tx+"]"}return c},cvtOp:{"-->":"->","<=>":"<-->",},};this.getRules=function(c){if(typeof c=="string"){return this.rulesMap[c.toLowerCase()]}return c};this.makeHtml=function(e,d){var c=new TextMaker(this.getRules(d||"html"));e.walk(c);return c.res()};this.RomanNum={i:1,ii:2,iii:3,iv:4,v:5,vi:6,vii:7,viii:8};var b={D:new ChemAtom(1,"D",2)};this.isAbstract=function(d){var c=new IsAbstract();d.walk(c);return c.ok};this.calcMass=function(d){var c=new MassCalc();d.walk(c);return c.getSum()};this.findElem=function(c){return MenTbl[c]||b[c]};this.makeBruttoKey=function(f,c){if(typeof f=="string"){f=ChemSys.compile(f);if(!f.isOk()){return""}}var e,d=new ElemListMaker();f.walk(d);e=d.result();e.sortByHill();if(c){e.charge=0}return e.toString()};this.makeBrutto=function(d){var c=ChemSys.makeBruttoKey(d);return ChemSys.compile(c)};this.graphProps=function(e,l,q){q=q||this.rulesHtml;var g,d,k,m,n,o;var h=document.defaultView;if(!h){h={}}if(!h.getComputedStyle){h.getComputedStyle=function(f,r){return f.currentStyle}}try{o=document.createElement("span");e.appendChild(o);var c={};function p(s,v){var u,x,y,t,f,r,z;r=c[v];if(!r){t=v.replace("*","A")||"A";o.innerHTML=t;f=t.charAt(0)=="<"?o.firstChild:o;y=h.getComputedStyle(f);x=y.fontWeight;u=+y.fontSize.slice(0,-2);z=new GrFontProps(y.fontFamily,u,(+x)?x>500:x=="bold",y.fontStyle=="italic");c[v]=r={fnt:l.createFont(z),col:y.color}}return r}n=p("std","*");m=new ChemGrProps(n);m.$MulChar=q.$MulChar||m.$MulChar;for(g in q){if(g[0]!="$"){k=q[g];if(k[0]=="<"&&/^<.+>.*<\/.+>$/.test(k)){m.styles[g]=p(g,q[g])}}}}finally{if(o){e.removeChild(o)}}return m};this.drawProps=function(f,c,d){var e=_chemGrBuilder(f,c,d);c.init(e.bounds.size());e.draw(c,e.bounds.A.negx());return 1};this.draw=function(h,c,g,d){if(h.nodeName){var e=c;c=h;h=e}g=ChemSys.getRules(g||"html");d=DrawSys.create(d,c);var f=this.graphProps(c,d,g);f.init();return this.drawProps(h,d,f)};this.view=function(f,c,e,d){d=DrawSys.create(d,c);this.draw(f,c,e,d);d.view()};this.isEmptyNode=function(f){var e=0;function d(g){if(g.tx!=""){return e=1}}function c(){return e=1}f.walk({atom:c,radical:c,custom:d,comm:d});return !e};this.init=function(){var h=["H,1.008","He,4.003","Li,6.941","Be,9.0122","B,10.811","C,12.011","N,14.007","O,15.999","F,18.998","Ne,20.179","Na,22.99","Mg,24.312","Al,26.092","Si,28.086","P,30.974","S,32.064","Cl,35.453","Ar,39.948","K,39.102","Ca,40.08","Sc,44.956","Ti,47.956","V,50.941","Cr,51.996","Mn,54.938","Fe,55.849","Co,58.933","Ni,58.7","Cu,63.546","Zn,65.37","Ga,69.72","Ge,72.59","As,74.922","Se,78.96","Br,79.904","Kr,83.8","Rb,85.468","Sr,87.62","Y,88.906","Zr,91.22","Nb,92.906","Mo,95.94","Tc,99","Ru,101.07","Rh,102.906","Pd,106.4","Ag,107.868","Cd,112.41","In,114.82","Sn,118.69","Sb,121.75","Te,127.6","I,126.905","Xe,131.3","Cs,132.905","Ba,137.34","La,138.906","Ce,140.115","Pr,140.908","Nd,144.24","Pm,145","Sm,150.4","Eu,151.96","Gd,157.25","Tb,158.926","Dy,162.5","Ho,164.93","Er,167.26","Tm,168.934","Yb,173.04","Lu,174.97","Hf,178.49","Ta,180.948","W,183.85","Re,186.207","Os,190.2","Ir,192.22","Pt,195.09","Au,196.967","Hg,200.59","Tl,204.37","Pb,207.19","Bi,208.98","Po,210","At,210","Rn,222","Fr,223","Ra,226","Ac,227","Th,232.038","Pa,231","U,238.29","Np,237","Pu,244","Am,243","Cm,247","Bk,247","Cf,251","Es,254","Fm,257","Md,258","No,259","Lr,260","Rf,261","Db,262","Sg,271","Bh,267","Hs,269","Mt,276","Ds,281","Rg,280","Cn,285","Nh,286","Fl,289","Mc,289","Lv,293","Ts,294","Og,294"],k,m,c,d,n,g,l;for(k=0;k<h.length;k++){m=h[k].split(",");MenTblArray.push(MenTbl[m[0]]=new ChemAtom(+k+1,m[0],+m[1]))}var f=["Me:C,H*3","Et:C*2,H*5","Ph:C*6,H*5","Pr,n-Pr,Pr-n:C*3,H*7","iPr,i-Pr,Pr-i:C*3,H*7","Bu,nBu,n-Bu,Bu-n:C*4,H*9","i-Bu,Bu-i:C*4,H*9","Ac:C,H*3,C,O"];for(k in f){m=f[k].split(":");n=createElemList();c=m[0].split(",");d=m[1].split(",");for(g in d){l=d[g].split("*");n.addElemRec(elemRec(l[0],+l[1]))}for(g in c){l=c[g];RadicalsMap[l]=new ChemRadical(l,n)}}}};ChemSys.rulesMap={html:ChemSys.rulesHtml,text:ChemSys.rulesText,bb:ChemSys.rulesBB,math:ChemSys.rulesMhchem,};ChemSys.init();ChemSys.navLang=navigator.language||navigator.browserLanguage||navigator.userLanguage;ChemSys.curLang=ChemSys.navLang=ChemSys.navLang.split("-")[0];ChemSys.Dict={ru:{$Native:"Русский",$English:"Russian","Internal error: [msg]":"Внутренняя ошибка: [msg]","Browser does not support canvas-graphics":"Браузер не поддерживает canvas-графику","Formula can not be displayed as text":"Формулу нельзя отобразить в текстовом виде","Expected '(' after [S]":" Требуется '(' после [S]","Unexpected '[C]'":"Неверный символ '[C]' в позиции [pos]","Expected '[ok]' instead of '[bad]'":"Требуется '[ok]' вместо '[bad]' в позиции [pos]","Invalid character '[C]'":"Недопустимый символ '[C]' в позиции [pos]","Russian element character":"Недопустимый русский символ '[C]'. Для описания химического элемента должны использоваться только латинские символы.","Non-latin element character":"Недопустимый символ '[C]'. Для описания химического элемента должны использоваться только латинские символы.","Unknown element character '[C]'":"Недопустимый символ '[C]' описания реагента в позиции [pos]","Expected '[C]'":"Требуется '[C]' в позиции [pos]","Unknown element '[Elem]'":"Ошибочный элемент '[Elem]' в позиции [pos]","Comment is not closed":"Не закрыт комментарий, начатый в позиции [pos]","Abstract koefficient is not closed":"Не закрыт абстрактный коэффициент, начатый в позиции [pos]","Abstract element is not closed":"Не закрыт абстрактный элемент, начатый в позиции [pos]","Expected node declaration before charge":"Неизвестно, к чему нужно применить заряд в позиции [pos]","Invalid charge declaration":"Ошибка в описании заряда в позиции [pos]","It is necessary to close the bracket":"Необходимо закрыть скобку, открытую в позиции [pos]","Undefined variable [name]":"Не определена числовая переменная '[name]' в позиции [pos]","Invalid node reference '[ref]'":"Неправильная ссылка на узел '[ref]' в позиции [pos]","Invalid branch close":"Нельзя закрыть ветку в позиции [pos], которая не открыта","Cant close branch before bracket":"Нельзя закрыть ветку в позиции [pos], пока не закрыта скобка в позиции [pos0]","Invalid bracket close":"Нет пары для скобки, закрытой в позиции [pos]","It is necessary to close the branch":"Необходимо закрыть ветку, открытую в позиции [pos]","Expected [must] instead of [have]":"Требуется [must] вместо [have] в позиции [pos]","Invalid middle point":"Не используется промежуточная точка","Cant create ring":"Невозможно создать кольцо","Cant close ring":"Невозможно замкнуть кольцо","Invalid version":"Для формулы требуется CharChem версии [need] вместо [cur]","(s)":"(тв)","(l)":"(ж)","(g)":"(г)","(aq)":"(р-р)","Periodic Table":"Периодическая система химических элементов","Table legend":"Группы химических элементов",Group:"Группа",Period:"Период",Row:"Ряд","[x]-block":"[x]-блок",Lanthanides:"Лантаноиды",Actinides:"Актиноиды","Alkali metals":"Щелочные металлы","Alkaline earth metals":"Щёлочноземельные металлы","Transition metals":"Переходные металлы","Post transition metals":"Постпереходные металлы",Metalloids:"Полуметаллы","Other nonmetals":"Неметаллы",Halogens:"Галогены","Noble gases":"Инертные газы","Unknown props":"Св-ва неизвестны",H:"Водород",He:"Гелий",Li:"Литий",Be:"Бериллий",B:"Бор",C:"Углерод",N:"Азот",O:"Кислород",F:"Фтор",Ne:"Неон",Na:"Натрий",Mg:"Магний",Al:"Алюминий",Si:"Кремний",P:"Фосфор",S:"Сера",Cl:"Хлор",Ar:"Аргон",K:"Калий",Ca:"Кальций",Sc:"Скандий",Ti:"Титан",V:"Ванадий",Cr:"Хром",Mn:"Марганец",Fe:"Железо",Co:"Кобальт",Ni:"Никель",Cu:"Медь",Zn:"Цинк",Ga:"Галлий",Ge:"Германий",As:"Мышьяк",Se:"Селен",Br:"Бром",Kr:"Криптон",Rb:"Рубидий",Sr:"Стронций",Y:"Иттрий",Zr:"Цирконий",Nb:"Ниобий",Mo:"Молибден",Tc:"Технеций",Ru:"Рутений",Rh:"Родий",Pd:"Палладий",Ag:"Серебро",Cd:"Кадмий",In:"Индий",Sn:"Олово",Sb:"Сурьма",Te:"Теллур",I:"Йод",Xe:"Ксенон",Cs:"Цезий",Ba:"Барий",La:"Лантан",Ce:"Церий",Pr:"Празеодим",Nd:"Неодим",Pm:"Прометий",Sm:"Самарий",Eu:"Европий",Gd:"Гадолиний",Tb:"Тербий",Dy:"Диспрозий",Ho:"Гольмий",Er:"Эрбий",Tm:"Тулий",Yb:"Иттербий",Lu:"Лютеций",Hf:"Гафний",Ta:"Тантал",W:"Вольфрам",Re:"Рений",Os:"Осмий",Ir:"Иридий",Pt:"Платина",Au:"Золото",Hg:"Ртуть",Tl:"Таллий",Pb:"Свинец",Bi:"Висмут",Po:"Полоний",At:"Астат",Rn:"Радон",Fr:"Франций",Ra:"Радий",Ac:"Актиний",Th:"Торий",Pa:"Протактиний",U:"Уран",Np:"Нептуний",Pu:"Плутоний",Am:"Америций",Cm:"Кюрий",Bk:"Берклий",Cf:"Калифорний",Es:"Эйнштейний",Fm:"Фермий",Md:"Менделеевий",No:"Нобелий",Lr:"Лоуренсий",Rf:"Резерфордий",Db:"Дубний",Sg:"Сиборгий",Bh:"Борий",Hs:"Хассий",Mt:"Мейтнерий",Ds:"Дармштадтий",Rg:"Рентгений",Cn:"Коперниций",Nh:"Нихоний",Fl:"Флеровий",Mc:"Московий",Lv:"Ливерморий",Ts:"Теннессин",Og:"Оганесон"},en:{"Invalid version":"Formula requires CharChem version [need] instead of [cur]",$Native:"English",$English:"English","Table legend":"Chemical element groups",H:"Hydrogen",He:"Helium",Li:"Lithium",Be:"Beryllium",B:"Boron",C:"Carbon",N:"Nitrogen",O:"Oxygen",F:"Fluorine",Ne:"Neon",Na:"Sodium",Mg:"Magnesium",Al:"Aluminium",Si:"Silicon",P:"Phosphorus",S:"Sulfur",Cl:"Chlorine",Ar:"Argon",K:"Potassium",Ca:"Calcium",Sc:"Scandium",Ti:"Titanium",V:"Vanadium",Cr:"Chromium",Mn:"Manganese",Fe:"Iron",Co:"Cobalt",Ni:"Nickel",Cu:"Copper",Zn:"Zinc",Ga:"Gallium",Ge:"Germanium",As:"Arsenic",Se:"Selenium",Br:"Bromine",Kr:"Krypton",Rb:"Rubidium",Sr:"Strontium",Y:"Yttrium",Zr:"Zirconium",Nb:"Niobium",Mo:"Molybdenum",Tc:"Technetium",Ru:"Ruthenium",Rh:"Rhodium",Pd:"Palladium",Ag:"Silver",Cd:"Cadmium",In:"Indium",Sn:"Tin",Sb:"Antimony",Te:"Tellurium",I:"Iodine",Xe:"Xenon",Cs:"Caesium",Ba:"Barium",La:"Lanthanum",Ce:"Cerium",Pr:"Praseodymium",Nd:"Neodymium",Pm:"Promethium",Sm:"Samarium",Eu:"Europium",Gd:"Gadolinium",Tb:"Terbium",Dy:"Dysprosium",Ho:"Holmium",Er:"Erbium",Tm:"Thulium",Yb:"Ytterbium",Lu:"Lutetium",Hf:"Hafnium",Ta:"Tantalum",W:"Tungsten",Re:"Rhenium",Os:"Osmium",Ir:"Iridium",Pt:"Platinum",Au:"Gold",Hg:"Mercury",Tl:"Thallium",Pb:"Lead",Bi:"Bismuth",Po:"Polonium",At:"Astatine",Rn:"Radon",Fr:"Francium",Ra:"Radium",Ac:"Actinium",Th:"Thorium",Pa:"Protactinium",U:"Uranium",Np:"Neptunium",Pu:"Plutonium",Am:"Americium",Cm:"Curium",Bk:"Berkelium",Cf:"Californium",Es:"Einsteinium",Fm:"Fermium",Md:"Mendelevium",No:"Nobelium",Lr:"Lawrencium",Rf:"Rutherfordium",Db:"Dubnium",Sg:"Seaborgium",Bh:"Bohrium",Hs:"Hassium",Mt:"Meitnerium",Ds:"Darmstadtium",Rg:"Roentgenium",Cn:"Copernicium",Nh:"Nihonium",Fl:"Flerovium",Mc:"Moscovium",Lv:"Livermorium",Ts:"Tennessine",Og:"Oganesson"}};ChemSys.addDict=function(f){var e,c,d,b;for(e in f){c=f[e];d=this.Dict[e];if(!d){this.Dict[e]=c}else{for(b in c){d[b]=c[b]}}}};ChemSys.lang=function(c,g,f){var b,e=ChemSys.Dict[f||ChemSys.curLang]||ChemSys.Dict.en,d=e[c];if(d===undefined){d=c}if(g){for(b in g){d=d.replace(new RegExp("\\["+b+"\\]","g"),g[b])}}return d};function IsNonText(){var b=this;b.ok=0;b.init=function(){mw.ok=0};b.bond=function(c){return b.ok=c.bText^1}}function IsAbstract(){var c=this;c.ok=0;function b(d){if(isAbsK(d)){return c.ok=1}}c.agentPre=c.itemPre=function(d){return b(d.n)};c.custom=function(d){return c.ok=1}}function MassCalc(){var c=[],b=[0];this.getList=function(){return c.length?c:b};this.getSum=function(){var f=0,e,d=this.getList();for(e in d){f+=d[e]}return f};this.atom=function(d){b[0]+=d.M};this.radical=function(f){var e=f.items,d=0,g;for(;d<e.length;d++){g=e[d];b[0]+=g.elem.M*g.n}};this.itemPre=this.bracketBegin=function(d){b.unshift(0)};this.mul=function(d){b.unshift({n:d.n});b.unshift(0)};this.itemPost=this.bracketEnd=function(e){var d=b.shift();if(e.M){d=e.M}d*=e.n;b[0]+=d};this.mulEnd=function(e){var d=b.shift();var f=b.shift();d*=f.n;b[0]+=d};this.agentPost=function(e){if(b[1]&&typeof b[1]=="object"&&b[1].n){var f=b[1].n;var d=b.shift();b.shift();b[0]+=d*f}c.push(b[0]);b=[0]}}function ChargeCalc(){var c=this,b=[0];c.result=function(){return b[0]};c.agentPre=c.bracketBegin=c.mul=function(d){b.unshift(0)};c.agentPost=function(d){var e=b.shift()*d.n;b[0]+=e};c.bracketEnd=function(e){var d=b.shift();if(e.charge){d=e.charge.val}b[0]+=d*e.n};c.nodePost=function(d){b[0]+=d.chargeVal()};c.mulEnd=function(d){var e=b.shift()*d.beg.n;b[0]+=e}}function ElemListMaker(){var d=this,b=[createElemList()];d.result=function(){return b[0]};d.agentPre=d.itemPre=d.bracketBegin=d.mul=function(e){b.unshift(createElemList())};function c(f){var e=b.shift();e.scale(f.n);b[0].addList(e)}d.agentPost=d.itemPost=d.mulEnd=c;d.bracketEnd=function(f){var e=b[0].charge;c(f);if(f.charge){b[0].charge+=f.charge.val*f.n-e}};d.nodePost=function(e){b[0].charge+=e.chargeVal()};d.atom=function(e){b[0].addElem(e)};d.custom=function(e){b[0].addCustom(e.tx)};d.radical=function(e){b[0].addRadical(e)}}ElemListMaker.create=function(b){var c=new ElemListMaker();b.walk(c);return c.result()};function TextMaker(o){o=o||ChemSys.rulesHtml;var k=this,m=[{tx:""}],g=0,n=0,e=1;k.res=function(){return m[0].tx};function q(r,s){if(!(r in o)){return s}return o[r].replace(/\*/g,s)}function f(r){m[0].tx+=r}function b(){if(e){e=0}else{f(" ")}}function p(r,s){f(q(r,s))}function h(){m[0].neg=1}function l(){m.unshift({tx:""})}function d(){var r=m.shift();if(r.neg){m[0].tx=r.tx+m[0].tx}else{m[0].tx+=r.tx}}k.atom=function(r){if(n){p("ColorPre",n)}f(q("Atom",r.id));if(n){p("ColorPost",n)}};k.custom=function(r){p("Custom",r.tx)};k.comm=function(r){p("Comment",r.tx)};k.radical=function(r){p("Radical",r.label)};k.itemPre=function(t){if(t.color){p("ColorPre",t.color)}if(t.atomNum){var u=t.customNumber;if(u===undefined){u=t.obj.n||""}var r=q("MassAndNum",u).replace("@",t.M||"");f(r)}else{if(t.M){p("ItemMass",t.M)}}n=t.atomColor};k.itemPost=function(r){if(r.charge){p("ItemCharge",r.charge.tx)}n=0;if(r.n!==1){p("ItemCnt",r.n)}if(r.color){p("ColorPost",r.color)}};k.bond=function(s){l();if(s.color){p("ColorPre",s.color)}var r=s.tx;if(!s.N){r=o.$InvisibleBond||" "}f(r);if(s.pt.x<0){h();g=1}if(s.color){p("ColorPost",s.color)}d()};function c(t,v){var s=t.charge;if(s){if(!(v^s.bLeft)){var r=s.tx,u=o.cvtCharge;if(typeof u=="object"){if(r in u){r=u[r]}}p("NodeCharge",r)}}}k.bracketBegin=function(r){c(r.end,1);f(r.tx)};k.bracketEnd=function(r){f(r.tx);if(r.n!==1){p("ItemCnt",r.n)}c(r)};k.mul=function(r){p("Mul",o.$MulChar||"*");if(r.n!==1){p("MultiK",r.n)}};k.nodePre=function(r){c(r,1);l()};k.nodePost=function(r){if(g){h();g=0}d();c(r)};k.agentPre=function(r){b();if(r.n!=1){p("AgentK",r.n)}};k.operation=function(v){b();if(typeof o.Operation=="function"){f(o.Operation(v))}else{var s,r="";if(s=v.commentPre){r=q("OpComment",s.tx)}var u,t=o.cvtOp;if(typeof t=="object"){u=t[v.srcText]}r+=u||v.dstText;if(s=v.commentPost){r+=q("OpComment",s.tx)}p("Operation",r)}};k.entityPre=function(){l()};k.entityPost=function(){d()}}function ChemDomMgrJQ(){this.root=function(){return $("<div>")};this.bind=function(b,c){b.data("o",c)};this.make=function(d,e,c){if(!d||d[0]!="<"){d="<span>"}var b=$(d);b.text(e);this.on(c,b);return b};this.add=function(b,d,c){if(c){b.prepend(d)}else{b.append(d)}};this.addSpace=function(b){b.append(" ")};this.on=function(c,b){if(c&&(c in this)){this[c](b)}}}function makeDOM(g,k,d){k=k||ChemSys.rulesHtml;d=d||new ChemDomMgrJQ();var c=d.root(),e=0,b=[c];function h(n,o,l,m){d.add(l||b[0],d.make(k[n],o),m)}function f(m,l,n){if(l&&(!l.bLeft^n)){h("NodeCharge",l.tx,m,n)}}g.walk({entityPre:function(){var l=d.make("","","entity");d.add(b[0],l);b.unshift(l)},entityPost:function(){b.shift();d.addSpace(c)},operation:function(n){var l,m=d.make(k.Operation,"","operation");if(l=n.commentPre){d.add(m,d.make(k.OpComment,l.tx))}d.add(m,d.make("",n.dstText));if(l=n.commentPost){d.add(m,d.make(k.OpComment,l.tx))}d.add(b[0],m);d.bind(m,n)},bond:function(m){var l=d.make("",m.N?m.tx:(k.$InvisibleBond||" "),"bond");d.add(b[0],l,e=m.pt.x<0);d.bind(l,m)},nodePre:function(m){var l=d.make("","","node");d.add(b[0],l,e);d.bind(l,m);b.unshift(l);e=0;f(l,m.charge,1)},nodePost:function(m){var l=b.shift();f(l,m.charge)},itemPre:function(m){var l=d.make(k.Item,"","item");d.add(b[0],l);d.bind(l,m);b.unshift(l)},itemPost:function(n){var m=b.shift();if(n.n!==1){var l=d.make(k.ItemCnt,n.n);d.add(m,l)}},mul:function(m){var l=d.make("","","mul");h("Mul",k.$MulChar,l);if(m.n!==1){h("MultiK",m.n,l)}d.add(b[0],l);d.bind(l,m)},bracketBegin:function(m){var l=d.make("",m.tx,"bracketBegin");d.add(b[0],l);d.bind(l,m);f(l,m.end.charge,1)},bracketEnd:function(m){var l=d.make("",m.tx,"bracketEnd");if(m.n!==1){h("ItemCnt",m.n,l)}f(l,m.charge);d.add(b[0],l);d.bind(l,m)},atom:function(l){h("Atom",l.id)},comm:function(l){h("Comment",l.tx)},radical:function(l){h("Radical",l.label)},custom:function(l){h("Custom",l.tx)}});d.bind(c,g);return c}function SubChain(){this.index=SubChain.s_next++;var b=[];this.getNodes=function(){return b};this.setCh=function(c){for(var d in b){b[d].ch=c}};this.findByPt=function(e){var c,d;for(c in b){d=b[c];if(d.pt.equals(e)){return d}}return 0};this.addNode=function(c){b.push(c);c.sc=this.index};this.delNode=function(d){var c=b.length;while(c>0){c--;if(d==b[c]){b.splice(c,1);return}}};this.add=function(c,g){var d,f,e=b[0];for(d in c){f=c[d];f.pt.addi(g);f.ch=e.ch;f.sc=e.sc;b.push(f)}}}SubChain.s_next=1;function Chain(){this.index=Chain.s_next++;var c=0,b={};this.getLst=function(){return b};this.findByPt=function(d){if(!c){return 0}return c.findByPt(d)};this.addNode=function(d){if(!c){c=new SubChain();b[c.index]=c}d.ch=this.index;c.addNode(d)};this.closeSC=function(d){if(c&&d){c.delNode(d)}c=0;if(d){this.addNode(d);d.pt.init(0,0)}};this.getSC=function(d){return b[d]};this.getCurSC=function(){return c};this.setCur=function(d){c=d};this.delSC=function(d){var e=b[d];if(e){delete b[d];return e.getNodes()}};this.addLst=function(d){var e,f;for(e in d){f=d[e];b[f.index]=f;f.setCh(this.index)}}}Chain.s_next=1;function ChainSys(){this.curCh=0;this.chains={};this.findByPt=function(b){if(!this.curCh){return 0}return this.curCh.findByPt(b)};this.addNode=function(b){if(!this.curCh){var d=this.curCh=new Chain();this.chains[d.index]=d}this.curCh.addNode(b)};this.closeSC=function(b){if(this.curCh){this.curCh.closeSC(b)}};this.closeChain=function(){this.curCh=0};this.merge=function(e,n,o){var f=e.ch,b=e.sc,c=n.ch,m=n.sc;if(b==m){return}var p=this.chains[f],h=this.chains[c],g=p.getSC(b),d=h.getSC(m),k=o.calcPt(),l=n.pt.subx(k);if(!o.soft){d.add(p.delSC(b),l)}h.addLst(p.getLst());delete this.chains[f];this.curCh=h;h.setCur(d)};this.setCur=function(c){var b=this.curCh=this.chains[c.ch];b.setCur(b.getSC(c.sc))};this.getCurSC=function(){return this.curCh?this.curCh.getCurSC():0}}function Macros(b){this.name=b;this.body="";this.exec=function(c){return this.body}}function _preProcess(c){var l=/[A-Z]/i,d=/^[A-Z][A-Z\d]*$/i;function o(q,p){this.src="";this.dst="";this.stk=[];this.pos=0;if(q instanceof o){this.src=q.src;this.pos=q.pos}else{if(typeof q=="string"){this.src=q;if(p){this.pos=p}}}}o.prototype={err:function(s,t){if(t){if(t<0){this.pos+=t}else{this.pos=t}}var p=this.src.substring(0,m.pos),q=this.src.substring(m.pos);throw new Error(s)},n:function(r){if(r===0){return""}if(!r){r=1}if(this.pos+r>this.src.length){this.err("Unexpected end of macros")}var q=this.pos,p=q+r,t=this.src.substring(q,p);this.pos=p;return t},s:function(q,s){var r=this.pos,p=this.src.indexOf(q,r);if(p<0){if(s){return null}this.err("Expected "+q+" character in macros")}this.pos=p+q.length;if(r==p){return""}return this.src.substring(r,p)},end:function(){return this.pos<this.src.length},w:function(p){this.dst+=p},wf:function(){this.w(this.src.substring(this.pos));this.pos=this.src.length},push:function(){this.stk.push(this.dst);this.dst=""},pop:function(){var p=this.dst;this.dst=this.stk.pop();return p},clr:function(){this.dst=""}};function g(p){var t,s=p.pos,q=p.s("("),r=new Macros(q);if(!l.test(q.charAt(0))){p.err("Invalid macro name",s)}p.push();b(p);r.body=p.pop();t=p.n();if(t==";"){}else{if(t=="("){p.w("@"+q+t)}else{p.err("Invalid macros end")}}ChemSys.macros[q]=r}function f(r,t){var s,p=0,q=0;while(t<r.length){s=r.charAt(t);if(s=='"'){q=!q}else{if(s=="("&&!q){p++}else{if(s==","&&!q&&p==0){break}else{if(s==")"&&!q){if(p>0){p--}else{break}}}}}t++}return t}function k(q,s){q.pos--;var r=0;do{var w=q.pos,u=f(q.src,w);if(u>=q.src.length){q.err("Real params list is not closed")}var t=q.n(u-w),v=q.n();s[r++]=t;if(v==")"){break}}while(1)}function n(x,u,t){x.pos--;for(;;){var q,s,p,r,w=x.pos,v=f(x.src,w);if(v>=x.src.length){x.err("Formal params list is not closed")}r=x.n(v-w);q=r.indexOf(":");if(q<0){p=r;r=""}else{p=r.substring(0,q);r=r.substring(q+1)}if(!d.test(p)){x.err("Invalid parameter name: "+esc(p))}u[p]=r;t.push(p);s=x.n();if(s==")"){break}}}function h(p,u){var D=new o(p);var A=D.n(),C={},B=[];if(A!=")"){n(D,C,B)}if(B.length>0){var v,r,z,x,w=0,y;for(x in u){z=u[x];v=z.indexOf(":");if(v>0){r=z.substring(0,v);if(r in C){C[r]=z.substring(v+1);continue}}r=B[w++];if(z){C[r]=z}}D.wf();y=D.dst.split("&");for(x=1;x<y.length;x++){r="";for(z in C){if(y[x].substring(0,z.length)==z&&z.length>r.length){r=z}}if(!r){continue}y[x]=C[r]+y[x].substring(r.length)}D=new o("");for(x in y){D.src+=y[x]}}for(;;){A=D.s("@",1);if(A===null){D.wf();break}D.w(A);A=D.n();if(!l.test(A)){D.err("Invalid macro")}var q=A+D.s("("),t=ChemSys.macros[q],s={};if(!t){D.err("Macros not found: "+q)}A=D.n();if(A!=")"){k(D,s)}D.w(h(t.body,s))}return D.dst}function b(p){var r,q;while(1){q=p.s("@",1);if(q===null){p.wf();break}p.w(q);r=p.n();if(r==":"){g(p)}else{if(l.test(r)){p.w("@"+r);continue}else{p.pos--;break}}}}var m=new o(c);b(m);if(m.pos!=c.length){m.err("Invalid preprocessor finish")}var e=")"+m.dst;return h(e,{})}function _notImpl(b){throw new ChemError("Function is not implemented: "+b)}var SpecChars=[[/\|\^|ArrowUp/g,"↑"],[/(\|v)|(ArrowDown)/g,"↓"],[/\^o/g,"°"]];var SpecCharsB={alpha:"α",Alpha:"Α",beta:"β",Beta:"Β",gamma:"γ",Gamma:"Γ",delta:"δ",Delta:"Δ",epsilon:"ε",Epsilon:"Ε",zeta:"ζ",Zeta:"Ζ",eta:"η",Eta:"Η",theta:"θ",Theta:"Θ",iota:"ι",Iota:"Ι",kappa:"κ",Kappa:"Κ",lambda:"λ",Lambda:"Λ",mu:"μ",Mu:"Μ",nu:"ν",Nu:"Ν",xi:"ξ",Xi:"Ξ",omicron:"ο",Omicron:"Ο",pi:"π",Pi:"Π",rho:"ρ",Rho:"Ρ",sigma:"σ",Sigma:"Σ",tau:"τ",Tau:"Τ",upsilon:"υ",Upsilon:"Υ",phi:"φ",Phi:"Φ",chi:"χ",Chi:"Χ",psi:"ψ",Psi:"Ψ",omega:"ω",Omega:"Ω"};var Ops=[{op:"+"},{op:"-->",eq:1,dst:"—→"},{op:"->",eq:1,dst:"→"},{op:"®",eq:1,dst:"→"},{op:"→",eq:1},{op:"=",eq:1},{op:"↔",eq:1},{op:"<->",eq:1,dst:"↔"},{op:"<=>",eq:1,dst:"\u21CC"},{op:"<==>",eq:1,dst:"\u21CC"},{op:"*",dst:"∙"},{op:"!=",dst:"≠"}];var BondsSyn={"≡":"%","–":"-"};var BondDefs={"-":[1,0,0,1],"=":[2,0,0,1],"%":[3,0,0,1,"≡"],"--":[1,0,0,0,"-"],"==":[2,0,0,0,"="],"%%":[3,0,0,0,"≡"],"|":[1,90,0],"||":[2,90,0],"|||":[3,90,0],"/":[1,0,-1],"//":[2,0,-1],"///":[3,0,-1],"\\":[1,0,1],"\\\\":[2,0,1],"\\\\\\":[3,0,1]},BondDefMap={};function _initCompiler(){var c,d,b=Math.PI/180;for(c in BondDefs){BondDefs[c][1]*=b}for(c in BondsSyn){BondDefs[c]=BondDefs[BondsSyn[c]]}for(c in BondDefs){BondDefMap[c.charAt(0)]=1}}_initCompiler();function _chemCompiler(aU){var ba=new ChemExpr(),x,aZ=0,au,s="begin",ad=0,aI=0,g,l=0,aO,K,Q,o,a5,a7,u,bc,ab,r,f=[],D=[],a0=[],af=[],al,X=0,a8=0,R=0,aH=Math.PI/6,a9=Math.PI/180,aM,Z="agentMid",I=ChemSys.findElem;ba.src0=aU;function a6(c){return c==" "||c=="\t"||c=="\n"}function aa(c){return c>="0"&&c<="9"}function h(c){return c>="a"&&c<="z"}function ah(){return aU[aZ+1]}function aQ(d,c){c=c||{};if("pos" in c){c.pos++}throw new ChemError(d,c)}function be(){if(D.length){aQ("Invalid middle point",D[0])}}function az(c){g.cmds.push(c)}function aC(){var d=r[0];if(d&&d.m){r.shift();var bh=d.m,c=new ChemMulEnd(bh);bh.end=c;az(c)}}function aP(c,d){s=c;return d||0}function aw(c){return aU.substring(c,aZ)}function W(){while(aZ<x&&a6(au=aU[aZ])){aZ++}}function aE(){var c=aZ;while(aZ<x&&aU[aZ]!='"'){aZ++}if(aZ==x){aQ("Comment is not closed",{pos:c-1})}return aw(c)}function S(bh,c){var bl=aZ,bj=aZ,bi,bk=0;function d(){c.push(bj);bh.push(aw(bj));bj=aZ+1}for(;aZ<x;aZ++){bi=aU[aZ];if(bi=="("){bk++}else{if(bi==")"){if(bk--==0){break}}else{if(bi==","&&bk==0){d()}}}}if(aZ>=x){aQ("It is necessary to close the bracket",{pos:bl-1})}d();++aZ}function k(){var d=aZ,bj,bh,bi=0;while(aZ<x){bj=aU[aZ++];if(bj=="{"){bi++}else{if(bj=="}"){if(bi){bi--}else{break}}else{if(bj=="\\"){bh=aU[aZ];if(bh=="{"||bh=="}"){aZ++}}}}}return a2(aU.slice(d,aZ-1))}function an(){var bj=aZ,bh=aU[aZ],c=null,d="",bi;if(aa(bh)){while(aZ<x){d+=aU[aZ];bi=+d;if(isNaN(bi)||!/^[\d\.]+$/.test(d)){break}c=bi;aZ++}}else{if(bh=="'"){aZ++;while(aZ<x&&aU[aZ]!="'"){aZ++}if(aZ==x){aQ("Abstract koefficient is not closed",{pos:bj})}c=aw(bj+1);aZ++}}if(c!==null){ad=0}return c}function am(){var d="",c=0,bh;while(aZ<x){d+=aU[aZ];bh=ChemCharge.create(d);if(!bh){break}aZ++;c=bh}return c}function av(){var c=aZ,d=0;if(aU[c]=="("){while(c<x&&aU[c]!=")"){c++}if(aU[c]!=")"){aQ("It is necessary to close the bracket",{pos:aZ})}d=ChemCharge.create(aU.substring(aZ+1,c));if(d){aZ=c+1}}return d}function a2(c){var bj,bm,bi=c,bl,bh,bk,d;for(bj in SpecChars){bm=SpecChars[bj];bi=bi.replace(bm[0],bm[1])}bj=0;while(bj<bi.length){bl=bi.indexOf("[",bj);if(bl<0){break}bh=bi.indexOf("]",bl);if(bh<0){break}bk=bi.substring(bl+1,bh);d=SpecCharsB[bk];if(d){bi=bi.substr(0,bl)+d+bi.substr(bh+1)}else{bj=bl+1}}return G(bi)}function G(bi){var bh,bj,c,d=bi.indexOf("`");while(d>=0){c=bi.indexOf("`",d+1);if(c<0){break}bj=bi.substring(d+1,c);bh=ChemSys.lang(bj);if(bh==bj){bi=bi.substring(0,d)+bi.substring(d+1)}else{bi=bi.substring(0,d)+bh+bi.substring(c+1)}d=bi.indexOf("`")}bi=bi.replace("`","");return bi}function aD(c){var d=new ChemComment(a2(c));return d}var n={"$32":Math.sqrt(3)/2,"$3":Math.sqrt(3),"$3x2":Math.sqrt(3)*2,"$2":Math.sqrt(2),"$22":Math.sqrt(2)/2,"$2x2":Math.sqrt(2)*2,"½":0.5,"¼":1/4,"¾":3/4,"⅓":1/3,"⅔":2/3},M={};function m(c,bh){if(!c){return 0}var d=1;if(c.charAt(0)=="-"){d=-1;c=c.substring(1)}if(c.charAt(0)=="%"){var bk,bj=c.indexOf(":"),bi;if(bj>=0){bi=c.substring(1,bj);bk=c.substring(bj+1);M[bi]=bk}else{bi=c.substring(1);bk=M[bi];if(!bk){aQ("Undefined variable [name]",{name:bi,pos:bh+1})}}c=bk}if(c in n){return d*n[c]}return +c*d}var a4,ao=0,N=0,ax,aj=null,aS=null,aR=0,T=null,J=0,ai=1,z=0,U=0,p=0,a1=0,e=0,aK={M:function(c){ao=+c[0]},nM:function(c){aK.M(c);ax=c[1];N=1},L:function(d,c){ai=m(d[0],c[0])||1},ver:function(d){var bh=d[0].split("."),c=ChemSys.ver();if(bh.length>1){if(bh[0]>c[0]||(bh[0]==c[0]&&bh[1]>c[1])){aQ("Invalid version",{cur:ChemSys.verStr(),need:bh.join(".")})}}},color:function(c){aj=c[0]},itemColor:function(c){aS=c[0]},itemColor1:function(c){aR=c[0]},atomColor:function(c){T=c[0]},atomColor1:function(c){J=c[0]},slope:function(c){R=c[0]*a9},dblAlign:function(c){e=c[0]},dots:function(bo,bl){p=[];var bq=bo[0],bm;if(/^[!UTBDLR]+$/i.test(bq)){var bp,br="",bn=0,d=0,bj,bk={U:"T",D:"B",u:"t",d:"b"},bi={R:129,L:24,T:96,B:6},bh={Rt:1,Bl:2,Br:4,Lt:8,Lb:16,Tr:32,Tl:64,Rb:128};for(bm=0;bm<bq.length;bm++){bp=bq[bm];bp=bk[bp]||bp;if(bp=="!"){bn=255}else{if(bi[bp]){d|=bi[bp];br=bp}else{br+=bp;if(bh[br]){d&=~bh[br]}}}}d=d^bn;for(bm=0,bj=1;bm<8;bm++,bj<<=1){if(bj&d){p.push(22.5+bm*45)}}}else{for(bm in bo){p.push(m(bo[bm],bl[bm]))}}},dashes:function(bl,bj){a1=[];var bk,bo=bl[0];if(/^[-_.\/\\<>|]+$/.test(bo)){var d=0,bn,bm=0,bp=0,bi=0,bh;for(bk=0;bk<bo.length;bk++){bn=bo[bk];switch(bn){case".":bm++;bp++;bi++;break;case"-":d|=64;bm++;bp++;bi++;break;case"_":d|=4;bm++;bp++;bi++;break;case"|":d|=bp?1:16;bp++;break;case"/":d|=bm?2:32;bm++;break;case"\\":d|=bi?128:8;bi++;break;case"<":d|=40;bm++;bi++;break;case">":d|=130;break}}for(bk=0,bh=1;bk<8;bk++,bh<<=1){if(bh&d){a1.push(bk*45)}}}else{for(bk in bl){a1.push(m(bl[bk],bj[bk]))}}}};function b(c){ba.ents.push(g=c)}function ag(){var bj,d,bi,bh,c=Ops.length-1;while(c>=0&&aU.indexOf(Ops[c].op,aZ)!=aZ){c--}if(c<0){return null}d=Ops[c];bi=aZ+d.op.length;bj=aU.charAt(bi);if(!a6(bj)&&bj!='"'){return null}b(new ChemOp(d.op,d.dst||d.op,d.eq));g.setPos(aZ,bi);if(ad){bh=g.commentPre=aD(ad);g.pA=bh.pA=aI-1;bh.pB=aZ;ad=0}if(d.eq){l++}aZ=bi;if(aU[aZ]=='"'){aZ++;bh=g.commentPost=aD(aE());bh.pA=bi;g.pB=bh.pB=++aZ}return aP("begin")}function V(){o=new ChainSys();a7=a5=0;bc=ab=0;r=[];a0=[];g.part=l;p=a1=0;al={};var c=aZ;a8=0;if(aO){g.n=aO;c=K}else{if(ad){_notImpl("openAgent.coeffPre");c=aI}}g.pA=c}function B(c){if(c.o){aQ("It is necessary to close the bracket",{pos:c.pos})}else{aQ("It is necessary to close the branch",{pos:c.pos})}}function aT(){while(r.length&&r[0].m){aC()}if(r.length){B(r[0])}aL();aW();be();aC();g.pB=aZ;var bl,bq,bm=g.bonds,d=g.cmds,bj=0,bk,bi,c,bh,bp,bo={},bn;bl=0;while(bl<bm.length){bq=bm[bl++];c=bq.nodes;if(c.length==2&&!bq.midPt){bk=c[0].index;bh=c[1].index;bn=Math.min(bk,bh)+":"+Math.max(bk,bh);if(bp=bo[bn]){bp.N+=bq.N;bm.splice(--bl,1);while(d[bj]!=bq){bj++}d.splice(bj,1)}else{bo[bn]=bq}}}for(bl in bm){bq=bm[bl];c=bq.nodes;for(bk in c){bi=c[bk];bi.bonds.push(bq)}}c=g.nodes;for(bl in c){bi=c[bl];if(bi.bAuto){bi.items[0]=new ChemNodeItem(MenTbl.C);bm=bi.bonds;bh=0;for(bk in bm){bh+=bm[bk].N}if(bh<4){bp=new ChemNodeItem(MenTbl.H);bp.n=4-bh;bi.items[1]=bp}}}}function t(){if(a5&&!a5.pB){a5.pB=aZ}Q=aZ;if(au>="A"&&au<="Z"){return aP("agentElem",1)}if(BondDefMap[au]){aV();return aP(Z)}switch(au){case"`":return X=1;case"$":return aP("funcName",1);case"{":return aP("custom",1);case"^":return aP("nCharge",1);case"#":return aP("nodeRef",1);case";":aW();aL();ab=0;o.closeChain();return aP("agentSpace",1);case":":aZ++;while(aZ<x&&/[\dA-Z]/i.test(aU[aZ])){aZ++}w();al[aw(Q+1)]=a5;return aP(Z);case"<":q();return aP(Z,1);case">":P();return aP(Z,1);case"(":if(ah()=="*"){q();return aP(Z,2)}break;case'"':aZ++;var c=new aD(aE());aZ++;aq(c);return aP(Z);case"*":if(ah()==")"){P();return aP(Z,2)}return aP("mul",1);case"_":return aP("uniBond",1);case"c":w();return aP(Z,1)}if(ChemBrBegin.Map[au]){aN();return aP(Z,1)}if(ChemBrEnd.Lst.indexOf(au)>=0){bg();return aP(Z)}if(/[А-ЯЁ]/i.test(au)){aQ("Russian element character",{pos:aZ,C:au})}if(au>"\x7F"){aQ("Non-latin element character",{pos:aZ,C:au})}return -1}function aL(){if(a5){if(!a5.pB){a5.pB=u}H();a7=a5=0}}function at(c,bj){aL();be();var bi=new ChemNode(bj);bi.bAuto=c;a7=a5=bi;u=a5.pA=Q;bi.index=g.nodes.length;g.nodes.push(bi);az(bi);o.addNode(bi);a0.push(bi);var bh,d;for(bh in r){d=r[bh].o;if(d&&!d.nodes[1]){d.nodes[1]=a5}}for(bh in af){af[bh](bi)}aY(bi);return bi}function aG(c){return c.bAuto||ChemSys.isEmptyNode(c)}function A(c){var bh=0,d;if(bc){if(bc.soft&&!c&&!aG(bc.nodes[0])){o.closeSC(0)}else{bh=bc.calcPt();bc.soft=0}}bh=bh||new Point();d=o.findByPt(bh);if(d){a5=d;a0.push(d)}else{d=at(c,bh)}F();return a5}function w(){if(!a5){A(1)}}function ap(d){aX();d.fixed=1;var c=bc?bc.nodes[0]:0;if(c&&c.bAuto&&d.bAuto&&bc.soft){bc.soft=0}if(c&&!bc.soft&&!(c.ch==d.ch&&c.sc!=d.sc)){if(c.fixed&&d.fixed){o.setCur(d)}else{o.merge(c,d,bc)}}else{o.setCur(d)}a5=d;a0.push(d);F()}function aX(){}function q(){aW();r.unshift({n:a5,b:bc,pb:ab,pos:Q,nb:a0});a0=[]}function P(){aW();aC();var c=r.shift();if(!c){aQ("Invalid branch close",{pos:aZ})}if(c.o){aQ("Cant close branch before bracket",{pos:aZ,pos0:c.pos+1})}a5=c.n;bc=c.b;ab=c.pb;a0=c.nb;o.setCur(a5)}function aN(){a7=0;var d=new ChemBrBegin(au);d.setPos(aZ,aZ+1);var c=a5;if(!c&&r.length){if(r[0].o){c=r[0].o.nodes[0]}}d.nodes[0]=c;d.bond=bc;d.color=aj;az(d);r.unshift({o:d,pos:aZ});aL();if(!bc||bc.soft){o.closeSC()}}function bg(){aC();var bl=r.shift();if(!bl){aQ("Invalid bracket close",{pos:aZ})}var bk=bl.o;if(!bk){aQ("Cant close bracket before branch",{pos:aZ,pos0:bl.pos+1})}var bm=ChemBrBegin.Map[bk.tx];if(bm!=au){aQ("Expected [must] instead of [have]",{must:bm,have:au,pos:aZ,pos0:bl.pos+1})}var d=new ChemBrEnd(au,bk);bk.end=d;d.pA=aZ;function bj(bo){d.nodes[0]=bo}w(0);if(a5){bj(a5)}else{af.push(bj)}d.color=bk.color;var bi=g.cmds,bh=bi.length,bn=new IsNonText();az(d);while(!bn.ok&&bi[bh]!=bk){bi[bh].walk(bn);bh--}bk.bTxt=d.bTxt=!bn.ok;f.unshift(d);aZ++;var c=an();if(c!==null){d.n=c}d.pB=aZ;a7=d}function aY(bh){var d,c;for(d in f){c=f[d];if(!c.nodes[1]){c.nodes[1]=bh}}f.length=0}function F(c){if(bc){bc.nodes[1]=a5;aW()}}function aW(){if(bc){if(!bc.nodes[1]){A(1)}bc=0}}function L(c){var d=new ChemBond();d.setPos(c,aZ);az(d);g.bonds.push(d);if(aj){d.color=aj}return d}function aB(d,c){d.align=c.align||e;if(c.H&&d.N==1){d.style=":"}if(c.C){switch(c.C){case"-":d.arr0=1;break;case"+":d.arr0=d.arr1=1;break;default:d.arr1=1}}if(c["<"]){d.arr0=1}if(c[">"]){d.arr1=1}if(c["~"]){c.S="~"}if(c.S){if(/^..[lrm]$/i.test(c.S)){d.style=c.S.substring(0,2);d.align=c.S[2]}else{d.style=c.S}}if(d.align){d.align=d.align.toLowerCase()}d.brk=!d.soft}function ac(bj,d){aW();w();var bl=L(d||Q-X);bl.pt=bj.pt;bl.nodes[0]=a5;aL();if(bj.soft){bl.soft=1}bl.tx=bj.tx;var bm=bl.N=bj.N;bl.slope=bj.slope;bc=bl;ab=bc;if(f.length){f[0].bond=bl;f.length=0}bl.bText=is0(Math.abs(bj.pt.x)-1)&&is0(bj.pt.y);if(bj.T){bl.tx=bj.T}function bi(bq,bn,bo){var bp=bj[bq];if(bp){if(bp=="-"){bj.w0=bn;bj.w1=0}else{if(bp=="2"){bj.w0=bj.w1=bn}else{if(bp=="1"||bp=="0"){bj.w0=bj.w1=0}else{if(bp=="+"){bj.w0=0;bj.w1=bn}else{bp=0}}}}if(bp&&bo){a8=bj.w1}}return bp}bi("w",1)||bi("d",-1)||bi("W",1,1)||bi("D",-1,1);if(bj.w0||bj.w1){bl.w0=bj.w0;bl.w1=bj.w1}aB(bl,bj);if(D.length){bl.midPt=[];bl.pA=D[0].pos;var bk,c,bh=bl.pt.clone();for(c in D){bl.midPt.push(bk=D[c].pt);bl.pt.addi(bk)}bl.midPt.push(bh);D.length=0}}function aF(bm,bj,bi){if(!bm){return 0}if(bm.charAt(0)=="#"){var bl=bm.substring(1).split(";"),bh=0,d,bk,c=bi+1;for(d in bl){bk=aA(bl[d],c);bh+=bk.pt[bj];c+=bl[d].length+1}bh/=bl.length;w();return bh-a5.pt[bj]}return m(bm,bi)}function Y(bj,bh,bl,bk){bl=bl||new Point();if(!ab){bl.init(bk,0);return bl}var bm=a5.pt,bn=ab.nodes[0].pt;var bk=bm.dist(bn);var bi=Math.PI*2/bh;var d=bm.subx(bn).polarAngle();var c=d+bj*bi;bl.fromRad(c).muli(bk);return bl}function ak(d,c){var br=new Point(),bh,bm;bm=d.L;if(bm){bm=m(bm,c.L)}else{bm=ai}function bl(bs){br.fromDeg(bs).muli(bm)}if("p" in d){w();var bk,bj,bn,bq=d.p.split(";"),bi=c.p;for(bj in bq){bk=aA(bn=bq[bj],bi);br.addi(bk.pt);bi+=bn.length+1}br.muli(1/bq.length);br.subi(a5.pt)}else{if("P" in d){bh=d.P===true?5:(+d.P||5);Y(bh<0?-1:1,Math.abs(bh),br,bm)}else{if("a" in d){var bp=0;if(ab){w();var bo=a5.pt.subx(ab.nodes[0].pt);bp=bo.polarAngle()*180/Math.PI}bp+=m(d.a,c.a);bl(bp)}else{if("A" in d){bl(m(d.A,c.A))}}}}bh=d.x;if(bh){br.x+=aF(bh,"x",c.x)}bh=d.y;if(bh){br.y+=aF(bh,"y",c.y)}return br}function a3(bh,d,bk,bm){var bj,c,bi,bl;for(bj in bh){c=bh[bj];bi=c[0];bl=c.substring(1);bk[bi]=bl||true;bm[bi]=d[bj]+1}}function y(bh,d,c){var bi={tx:"_",N:1,w0:a8,w1:a8},bj={};a3(d,c,bi,bj);if(/^2[xlrm]$/i.test(bi.N)){bi.align=bi.N[1];bi.N=2}else{bi.N=+bi.N}w();bi.pt=ak(bi,bj);ac(bi,bh)}function ae(c){while(aZ<x){au=aU[aZ];switch(au){case"0":case"o":c.N=0;break;case"h":c.H=1;break;case"w":c.w=(c.w=="+")?"-":"+";break;case"d":c.d=(c.d=="+")?"-":"+";break;case"x":c.cross=1;break;case"~":c.S="~";break;case"v":if(!c[">"]){c[">"]=1}else{if(!c["<"]){c["<"]=1;c[">"]=0}}break;default:return}aZ++}}function bd(bh,d){var bj={N:1,pt:new Point()},bi,c;aZ++;if(aU[aZ]==bh){bj.N++;aZ++}c=aZ;while(aZ<x&&aa(aU[aZ])){aZ++}bi=c==aZ?5:+aU.substring(c,aZ);Y(bh=="q"?-1:1,bi,bj.pt,ai);ae(bj);ac(bj,d);bc.bText=0}function C(){var bk=aZ-1;aZ++;if(aU[aZ]!="("){aQ("Expected '(' after [S]",{pos:aZ-1,S:"_m"})}aZ++;var d=[],c=[],bh={},bj={},bi;S(d,c);a3(d,c,bh,bj);w();bi=ak(bh,bj);D.push({pt:bi,pos:bk,pos1:aZ})}function E(d){var bi=a0.length,c=bi-2,bh;if(bi<3){aQ("Cant create ring",{pos:d})}while(c>=0&&a0[c]!=a5){c--}if(c<0){aQ("Cant close ring",{pos:d})}bh=L(d);bh.nodes.length=0;bh.tx=bh.ext="o";bh.N=1;for(c++;c<bi;c++){bh.nodes.push(a0[c])}}function O(bk,bj,bm){var bh={},c={},bp,d;a3(bk,bj,bh,c);bp=L(bm);bp.tx=bp.ext="s";d=bp.nodes;d.length=0;bp.o=bh.o;if(bh.N){bp.N=+bh.N}aB(bp,bh);function bl(bz){var bq=bp.nodes,bt=c["#"],bx,bu,br=bz.split(";"),by,bs,bA;for(bx in br){by=br[bx].split(":");if(by.length==1){bq.push(aA(by[0],bt))}else{bs=aA(by[0],bt);bA=aA(by[1],bt+by[0].length+1);if(bs.index>bA.index){var bw=bs;bs=bA;bA=bw}var bv=g.nodes;for(bu=bs.index;bu<bv.length;bu++){bq.push(bv[bu]);if(bA==bv[bu]){break}}}bt+=br[bx].length+1}}function bo(){var br=a0.length-1,bq=0,bs;while(br>=0){d.push(bs=a0[br]);if(!bq){bq=bs}else{if(bs==bq){break}}br--}}var bi,bn=bh["#"];if(bn){bl(bn)}else{bo()}bi=d.length;if(bi>3&&d[0]==d[bi-1]){d.length=bi-1;bp.o=1}}function aJ(c,bi,bh,d){if(!c){if(bh){return bi?9:3}else{return bi?12:6}}if(c>0){if(d){return bi?11:5}else{return bi?10:4}}if(d){return bi?7:1}return bi?8:2}function v(c){return aJ(c.slope,c.bNeg,is0(c.pt.y),c.bCorr)}function aV(){var by,bx,bj=0,bl,c,bm;for(by in BondDefs){if(aU.indexOf(by,aZ)==aZ){bx=by.length;if(bx>bj){bj=bx;bl=by}}}c=BondDefs[bl];aZ+=bj;var bn=c[2],bi=c[1],br={N:c[0],slope:bn,soft:c[3],tx:c[4]||bl};ae(br);var bs=R||aH,bz=c[1]+bn*bs;var bp=ab,bk=0,bh=!bi&&!bn;if(!R&&bp&&bp.bAuto){var bw=v(bp),bv=aJ(bn,X,bh,0);if(((bw==3||bw==9)&&bn)||((bw==8||bw==7)&&bv==4)||((bw==4||bw==5)&&bv==8)||((bw==10||bw==11)&&bv==2)||((bw==1||bw==2)&&bv==10)){bz=c[1]+bn*Math.PI/3;bk=1}}if(X){bz+=Math.PI}br.pt=new Point().fromRad(bz).muli(ai);ac(br);bc.bAuto=1;bc.bCorr=bk;bc.bNeg=X;X=0;bm=bc.nodes[0];if(!R&&bp&&bp.bAuto&&!bp.bCorr&&!bm.fixed){if(((bw==4||bw==5)&&bv==8)||((bw==2||bw==1)&&bv==10)||((bw==10||bw==11)&&bv==2)||((bw==8||bw==7)&&bv==4)||((bw==10||bw==8||bw==2||bw==4)&&bh)){var bB=bp.nodes[0].pt,bA=bm.pt.subx(bB),bu=bA.x<0?-1:1,bt=bA.y<0?-1:1,bC=new Point(Math.abs(bA.y)*bu,Math.abs(bA.x)*bt),bo=bC.addi(bB),bq=bo.subx(bm.pt);bp.bCorr=100;bm.pt=bo}}}function bb(){var d=a5.items,c=d.length;return c?d[c-1]:0}function H(){}function aq(d){if(f.length){aL();o.closeSC()}if(!a5){A()}H();var c=new ChemNodeItem(d);c.setPos(Q,aZ);a5.items.push(c);u=aZ;if(X){c.bCenter=1;X=0}c.M=ao;ao=0;c.atomNum=N;c.customNumber=ax;N=0;ax=undefined;if(aR){c.color=aR;aR=0}else{if(aS){c.color=aS}else{c.color=aj}}if(J){c.atomColor=J;J=0}else{c.atomColor=T}c.dots=p;c.dashes=a1;p=a1=0}function bf(bk){var bi,bm=+bk,c=g.nodes;if(bm){if(bm<0){bm+=c.length;if(bm<0){return 0}return c[bm]}if(bm>c.length){return 0}return c[--bm]}bl=al[bk];if(bl){return bl}var d,bl,bh=bk,bj;if(bj=I(bh)){d=g.nodes;bm=d.length;for(bi=0;bi<bm;bi++){bl=d[bi];if(bl.items.length==1&&bl.items[0].obj==bj){return bl}}}return 0}function aA(bh,c){var d=bf(bh);if(!d){aQ("Invalid node reference '[ref]'",{ref:bh,pos:c})}return d}var ay={begin:function(){W();if(aZ>=x){return 0}if(au=='"'){return aP("commPre",1)}var c=ag();if(c!==null){return c}K=aZ;aO=an();W();if(aZ==x){return 0}au=aU[aZ];if(au=="("&&a6(ah())){_notImpl("Superbracket")}return aP("agent")},commPre:function(){aI=aZ;ad=aE();return aP("begin",1)},agent:function(){b(new ChemAgent());V();return aP("agentIn")},agentIn:function(){var c=t();if(c<0){aQ("Unknown element character '[C]'",{C:au,pos:aZ})}return c},agentMid:function(){var c=t();if(c<0){aT();return aP("begin")}return c},agentElem:function(){var c=aZ-1;while(aZ<x&&h(aU[aZ])){aZ++}var bh=aw(c),d=I(bh);if(!d){aQ("Unknown element '[Elem]'",{pos:c,Elem:bh})}aq(d);return aP("postItem")},postItem:function(){var d,c=an();if(c!==null){d=bb();d.n=c;d.pB=aZ;return aP("postItem")}c=av();if(c){d=bb();d.charge=c;d.pB=aZ;return aP("postItem")}u=aZ;return aP(Z)},funcName:function(){var bi=aZ,bh,d=[],c=[];while(aZ<x&&aU[aZ]!="("){aZ++}if(aZ==x){aQ("Expected '(' after [S]",{S:"$"})}bh=aw(bi);aZ++;S(d,c);if(aK[bh]){aK[bh](d,c)}return aP(Z)},custom:function(){var bh=aZ,c,d=k();if(aZ>=x){aQ("Abstract element is not closed",{pos:bh-1})}c=RadicalsMap[d];aq(c||new ChemCustom(d));return aP("postItem")},nCharge:function(){if(!a7){aQ("Expected node declaration before charge",{pos:aZ-1})}var d=aZ,c=am();if(!c){aQ("Invalid charge declaration",{pos:d})}if(X){c.bLeft=1;X=0}a7.charge=c;return aP(Z)},nodeRef:function(){var bh=aZ,d,c;if(aa(au)||au=="-"){aZ++;while(aZ<x&&aa(aU[aZ])){aZ++}}else{if(/[A-Z]/i.test(au)){aZ++;while(aZ<x&&/^[A-Z\d]$/i.test(aU[aZ])){aZ++}}else{if(a6(au)){return aP("agentSpace",1)}}}d=aw(bh);c=aA(d,bh);if(bc){bc.brk=1}ap(c);return aP(Z)},agentSpace:function(){while(aZ<x&&a6(aU[aZ])){aZ++}return aP(Z)},uniBond:function(){w();var bi=aZ-1,d=[],c=[],bh=1;if(au=="("){aZ++;S(d,c)}else{if(au=="p"||au=="q"){bd(au,bi);bh=0}else{if(au=="m"){C();bh=0}else{if(au=="o"){aZ++;E(bi);bh=0}else{if(au=="s"){if(aU[++aZ]!="("){aQ("Expected '(' after [S]",{S:au,pos:aZ})}aZ++;S(d,c);O(d,c,bi);bh=0}}}}}if(bh){y(bi,d,c)}return aP(Z)},mul:function(){aC();var c=aZ-1,bh=an();var d=new ChemMul(bh||1);d.setPos(c,aZ);az(d);aL();o.closeSC();r.unshift({m:d});return aP(Z)}};try{aU=aU.replace(/−/g,"-");aU=ba.src=_preProcess(aU);aU+=" ";x=aU.length;while(aZ<aU.length){au=aU.charAt(aZ);var ar=ay[s]();aZ+=ar}}catch(aM){ba.error=(aM instanceof ChemError)?aM:new ChemError("Internal error: [msg]",{msg:aM.message})}return ba}ChemSys.compile=_chemCompiler;function GrFontProps(f,b,d,c){var e=this;e.family=f;e.height=b;e.bold=d;e.italic=c;e.descent=0;e.ascent=b}function GrFigure(){this.bounds=new Rect();this.org=new Point();this.updateBounds=function(e,c,f){var d=new Point(f,f),b=this.bounds;if(c){b.LT(e.subx(d));b.RB(e.addx(d))}else{b.minLT(e.subx(d));b.maxRB(e.addx(d))}};this.getIrc=function(){return this.irc?this.irc:this.bounds}}function GrFrame(){GrFigure.call(this);this.type=GrFrame.T;this.frames=[];this.figs=[];var b=this;this.addFr=function(c){this.frames.push(c)};this.addFig=function(c,d){this.figs.push(c);if(!d){this.bounds.unite(c.bounds)}};this.add=function(d,c){if(d.type==GrFrame.T){this.addFr(d)}else{this.addFig(d,c)}};this.uf=function(d,c){var e=d.org,f=d.bounds.clone();f.move(e);if(c){this.bounds=f}else{this.bounds.unite(f)}};this.update=function(){var d,f=1,c,e;for(d in b.frames){c=b.frames[d];b.uf(c,f);if(e=c.irc){e=e.clone();e.move(c.org);if(!this.irc){this.irc=e}else{this.irc.unite(e)}}f=0}for(d in b.figs){b.uf(b.figs[d],f);f=0}};this.draw=function(d,k){var e,g,h=b.frames,c=b.figs;for(e in h){g=h[e];g.draw(d,g.org.addx(k))}for(e in c){g=c[e];d.drawFig(g,g.org.addx(k))}d.drawFig(b,k)};this.moveChilds=function(d){function c(f){for(var e in f){f[e].org.addi(d)}}c(b.frames);c(b.figs)}}GrFrame.T="F";function GrLines(b,d,c){GrFigure.call(this);this.type=GrLines.T;this.color=b;this.style=c;this.width=d;this.fillColor=0;this.points=[];this.add=function(f,e){f.mv=e;this.points.push(f);this.updateBounds(f,this.points.length==1,(this.width||2)/2)};this.addxy=function(e,g,f){this.add(new Point(e,g),f)};this.addA=function(e){var f=0,g=e.length;while(f<g){this.addxy(e[f++],e[f++],e[f++])}}}GrLines.T="L";function makeGrRect(e,d,f,h,g){var c=new GrLines(f,h,g);c.addA([e.x,e.y,1,d.x,e.y,0,d.x,d.y,0,e.x,d.y,0,e.x,e.y,0]);return c}function GrEllipse(e,c,h,d,g,f){GrFigure.call(this);this.dx=e;this.dy=c;this.type=GrEllipse.T;this.color=d;this.width=g;this.fillColor=h;this.style=f;if(d&&g){var b=g;this.bounds.A.init(-b,-b);this.bounds.B.init(e+b,c+b)}else{this.bounds.B.init(e,c)}}GrEllipse.T="E";function GrText(d,c,b){GrFigure.call(this);this.type=GrText.T;this.font=c;this.text=d;this.color=b;this.bounds.B.init(c.textWidth(d),c.height);this.getIrc=function(){var f=this.bounds.clone(),e=this.font;f.A.y=e.descent;f.B.y=e.ascent;return f}}GrText.T="T";function BSplineExt(e,h){var g=e.length,f,c=e[0],b=e[g-1];if(h){if(b.equals(c)){b=e[g-2]}else{e.push(c)}e.push(e[1]);e.push(e[2]);e.unshift(b)}else{f=b.subx(e[g-2]);e.push(b.addx(f));e.push(e[g].addx(f));f=e[1].subx(c);e.unshift(c.subx(f))}}function createBSpline(s,w,r,b,k){var u,B=new GrLines(r,b),o=s.length,g=o-3,l=0,e=[0],c=s[1].equals(s[g]),v,q,f=0,p=1,d,A,m,x,y,z,C;for(u=1;u<g;u++){l+=(v=s[u].dist(s[u+1]));e[u]=v}q=Math.floor(l/w+0.5);if(k){if(q&1){if(c){q++}}else{if(!c){q++}}}w=l/q;for(u=0,v=0;;u++){if(p!=f){if(p>=g){break}f=p;d=s[f+1].subx(s[f]);A=1/e[f];x=s[f].mulx(3);x.subi(s[f-1]);x.addi(s[f+1].mulx(-3));x.addi(s[f+2]);x.muli(1/6);y=s[f].mulx(-2);y.addi(s[f-1]).addi(s[f+1]).muli(0.5);z=s[f+1].subx(s[f-1]).muli(0.5);C=s[f].mulx(4);C.addi(s[f-1]).addi(s[f+1]).muli(1/6)}var h=v*A;m=x.mulx(h).addi(y).muli(h).addi(z).muli(h).addi(C);B.add(m,k&&(u&1));v+=w;while(v>=e[p]){v-=e[p];p++}}B.add(c?B.points[0].clone():s[p]);return B}function DrawSys(){}DrawSys.prototype={createFont:function(b){throw new Error("Abstract call of DrawSys.createFont")},init:function(b){},drawFigure:function(b,c){},view:function(){}};DrawSys.create=function(c,b){c=c||"canvas";if(c instanceof DrawSys){return c}if(!b){throw new Error("Invalid DOM-node in DrawSys.create()")}if(typeof c=="string"&&c.toLowerCase()=="svg"){return new SvgDrawSys(b)}return new CanvasDrawSys(b)};var g_canvasFonts={};function CanvasDrawSys(c){var d=0,p=0,b="black",m=g_canvasFonts,q=0;function f(e){return Math.floor(e)+0.5}function o(e){return f(e.x)}function l(e){return f(e.y)}function k(z,s){var u="E",v=Math.ceil(s.height*1.5);var r=document.createElement("CANVAS");r.width=v;r.height=v;var D=r.getContext("2d");D.textBaseline="top";D.textAlign="left";D.font=z;var C=D.measureText(u).width,A=0,B=Math.floor(C/2);D.fillRect(0,0,v,v);D.fillStyle="#F00";D.fillText(u,0,0);var e=D.getImageData(B,0,1,v),t=e.data;while(A<v&&!t[A*4]){A++}if(A==v){return}s.descent=A;A=v-1;while(!t[A*4]){A--}s.ascent=A;D.fillStyle="#000";D.fillRect(0,0,v,v);D.fillStyle="#F00";u="g";C=D.measureText(u).width;D.fillText(u,0,0);e=D.getImageData(Math.floor(C*0.6),0,1,v);t=e.data;A=v-1;while(A>0&&!t[A*4]){A--}s.height=A||v-1}this.createFont=function(s){if(!p){return 0}var r="",e;if(s.italic){r+="italic "}if(s.bold){r+="bold "}r+=s.height+"px "+s.family;if(e=m[r]){s.ascent=e.a;s.descent=e.d;s.height=e.h}else{k(r,s);m[r]={a:s.ascent,d:s.descent,h:s.height}}s.textWidth=function(u){p.font=r;var t=p.measureText(u);return t.width};s.draw=function(v,u,t){if(t){p.fillStyle=t}p.font=r;p.fillText(u,v.x,v.y)};return s};this.init=function(e){if(!p){return}d.width=e.x+1;d.height=e.y+1;p.textBaseline="top";p.textAlign="left"};function h(v,w){var s,t,A,z,B=[];for(s in v.points){t=v.points[s];B.push([f(t.x+w.x),f(t.y+w.y),t.mv])}var r=v.color,e=v.fillColor;if(!r&&!e){r=b}function u(){var y,x=[];for(s in B){y=B[s];A=y[0];z=y[1];switch(y[2]){case 1:p.moveTo(A,z);break;case 2:x.push(y);break;default:if(x.length==2){p.bezierCurveTo(x[0][0],x[0][1],x[1][0],x[1][1],A,z);x.length=0}else{p.lineTo(A,z)}}}}if(e){p.beginPath();p.fillStyle=e;u();p.fill()}if(r){p.lineJoin=v.join||"round";p.lineCap=v.cap||"round";p.strokeStyle=r;p.lineWidth=v.width||1;p.beginPath();u();p.stroke()}}function n(z,F){var e=z.bounds,y=F.addx(z.dx,z.dy),E=f((F.x+y.x)/2),x=f((F.y+y.y)/2),t=f(E-F.x),w=z.fillColor;if(w){p.beginPath();p.fillStyle=w;p.arc(E,x,t,0,Math.PI*2,true);p.fill()}w=z.color;if(w){p.beginPath();p.strokeStyle=w;p.lineWidth=z.width||1;p.arc(E,x,t,0,Math.PI*2,true);p.stroke()}if(0){p.beginPath();p.strokeStyle="#0CC";p.lineWidth=1;var v=z.bounds.A.addx(F),s=z.bounds.B.addx(F);var u=o(v),D=l(v),r=o(s),C=l(s);p.lineTo(u,D);p.lineTo(r,D);p.lineTo(r,C);p.lineTo(u,C);p.lineTo(u,D);p.stroke()}}this.drawFig=function(u,v){if(!p){return}var z=v;switch(u.type){case GrLines.T:h(u,z);break;case GrEllipse.T:n(u,z);break;case GrText.T:u.font.draw(z,u.text,u.color);if(q){p.beginPath();var t=u.bounds.A.addx(z),r=u.bounds.B.addx(z),y=u.font;p.strokeStyle="gray";p.moveTo(o(t),l(t));p.lineTo(o(r),l(t));p.moveTo(o(t),l(r));p.lineTo(o(r),l(r));p.lineWidth=1;p.stroke();p.beginPath();p.strokeStyle="blue";p.moveTo(o(t),l(t)+y.descent);p.lineTo(o(r),l(t)+y.descent);p.moveTo(o(t),l(t)+y.ascent);p.lineTo(o(r),l(t)+y.ascent);p.stroke()}break;case GrFrame.T:if(q&0){p.beginPath();p.strokeStyle="#C80";p.lineWidth=1;var t=u.bounds.A.addx(z),r=u.bounds.B.addx(z);var s=o(t),x=l(t),e=o(r),w=l(r);p.lineTo(s,x);p.lineTo(e,x);p.lineTo(e,w);p.lineTo(s,w);p.lineTo(s,x);p.stroke()}break}};try{d=document.createElement("CANVAS");if(d&&d.getContext){p=d.getContext("2d")}}catch(g){}if(!p){c.innerHTML=ChemSys.lang("Browser does not support canvas-graphics");return 0}else{c.appendChild(d)}}CanvasDrawSys.prototype=new DrawSys;var svgFontCache={};if(!Math.log10){Math.log10=function(b){return Math.log(b)/Math.LN10}}function SvgDrawSys(b){var r="",l,c,o={},h=1;function f(t){return Math.floor(t*c)/c}function s(t){t=t+"";return'"'+esc(t)+'"'}function g(u){var t="";if(u){for(var v in u){t+=" "+v+"="+s(u[v])}}return t}function d(u){var t="";if(u){for(var v in u){t+=" "+v+":"+u[v]+"; "}}return t}function q(u,w,t){var v="<"+u+g(w);if(t){v+=" /"}return v+">"}function e(u){var t=JSON.stringify(u),v=o[t];if(!v){o[t]=v={name:"style"+h++,props:u}}return v.name}function p(){var t,v,u='<style type="text/css">\n  <![CDATA[\n';for(t in o){v=o[t];u+="  ."+v.name+" {"+d(v.props)+" }\n"}u+="  ]]>\n</style>\n";return u}this.createFont=function(D){var x=D.height;function y(H,E){var G=document.createElement("CANVAS");document.body.appendChild(G);G.width=H||16;G.height=E||16;var F=G.getContext("2d");return{canvas:G,ctx:F}}function z(F){var E=F.canvas;E.parentNode.removeChild(E)}function t(E){var F="";if(D.italic){F+="italic "}if(D.bold){F+="bold "}F+=x+"px "+D.family;E.font=F}function v(I,F){var O=I.ctx,M,K,E,L,H=I.canvas.width,N=I.canvas.height,G=H*4,J={};O.fillStyle="#000";O.fillRect(0,0,H,N);O.fillStyle="#FFF";O.textBaseline="top";O.textAlign="left";t(O);O.fillText(F,0,0);E=O.getImageData(0,0,H,N).data;for(L=0,K=0;K<N;K++){for(M=0;M<H;M++){if(E[L]){break}L+=4}if(M<H){break}}J.y1=K;for(K=N-1;K>=0;K--){L=K*G;for(M=0;M<H;M++){if(E[L]){break}L+=4}if(M<H){break}}J.y2=K;return J}var B=D.family+"@"+x+"@"+D.bold+"@"+D.italic,w=svgFontCache[B];if(!w){var C=y(D.height,D.height*1.4),u=v(C,"E"),A=v(C,"g");z(C);D.descent=u.y1;D.ascent=u.y2;D.height=A.y2;D.W={};svgFontCache[B]=w=D}else{D.descent=w.descent;D.ascent=w.ascent;D.height=w.height}D.textWidth=function(H){if(!H){return 0}var G=w.W[H];if(!G){var F=y(),E=F.ctx;t(E);G=w.W[H]=E.measureText(H).width;z(F)}return G};D.draw=function(E,H,F){var G={fill:F,"font-family":D.family,"font-size":x+"px"};if(D.bold){G["font-weight"]="bold"}if(D.italic){G["font-style"]="italic"}r+=q("text",{x:f(E.x),y:f(E.y+D.ascent),"class":e(G)})+esc(H+"")+"</text>\n"};return D};this.init=function(t){l=t;var u=Math.max(t.x,t.y);c=Math.max(1000,Math.pow(10,Math.floor(Math.log10(u))))};function k(B,C){var v=B.color,t=B.fillColor;var w,z,E,D,G,I="",H="",u=0;for(w in B.points){z=B.points[w];E=f(z.x+C.x);D=f(z.y+C.y);switch(z.mv){case 1:G="M";break;case 2:G=u++?"":"C";break;default:if(u){G="";u=0}else{G=H?"L":"M"}}I+=H+G+E+" "+D;H=" "}var A={fill:t||"none",stroke:v||"none"};if(B.width){A["stroke-width"]=B.width}if(B.cap){A["stroke-linecap"]=B.cap}if(B.join){A["stroke-linejoin"]=B.join}var F={d:I,"class":e(A)};r+=q("path",F,1)+"\n"}function n(t,A){var y=A.addx(t.dx,t.dy),x=f((A.x+y.x)/2),z=f((A.y+y.y)/2),w=f(x-A.x),v=f(z-A.y),u={};u.fill=t.fillColor?t.fillColor:"none";if(t.color){u.stroke=t.color;u["stroke-width"]=t.width}else{u.stroke="none"}r+=q("ellipse",{cx:x,cy:z,rx:w,ry:v,"class":e(u)},1)+"\n"}this.drawFig=function(t,u){switch(t.type){case GrLines.T:k(t,u);break;case GrText.T:t.font.draw(u,t.text,t.color);break;case GrEllipse.T:n(t,u);break}};var m=/^([0-9\.]+)([a-z]*)$/;this.getText=function(t){if(!t){t={xmlns:"http://www.w3.org/2000/svg"}}if(!t.width&&!t.height){t.width=f(l.x)+"px";t.height=f(l.y)+"px"}else{if(!t.width){}else{if(!t.height){}}}if(!t.viewBox){t.viewBox="0 0 "+f(l.x)+" "+f(l.y)}var u=q("svg",t)+"\n";u+="<!-- Generated by CharChem v."+ChemSys.verStr()+" -->\n";u+="<defs>\n";u+=p();u+="</defs>\n";u+=r;u+="</svg>";return u};this.view=function(){b.innerHTML="<span>"+this.getText()+"</span>"}}SvgDrawSys.prototype=new DrawSys;function ChemGrProps(f,b,e,c){var d=this;d.line=b;d.horizLine=e;d.lineWidth=c;d.thickWidth=0;d.lineSpace2=0;d.lineSpace3=0;d.subKY=0.5;d.bracketSubKY=0.3;d.supKY=0.5;d.bracketSupKY=0.3;d.hatch=0;d.dash=0;d.arrowL=0;d.arrowD=0;d.opSpace=0;d.$MulChar="∙";d.kw=40;d.flDblAlign=1;d.stdStyle=f;d.styles={};d.init=function(){var h=d.line=d.line||(d.stdStyle.fnt.height*1.6),g=d.lineWidth=d.lineWidth||(Math.ceil(h/d.kw));d.horizLine=d.horizLine||(d.stdStyle.fnt.textWidth("+")+d.stdStyle.fnt.height)/2;function k(m,l){d[m]=d[m]||l}k("thickWidth",g*4);k("hatch",g*3);k("dash",g*3);k("lineSpace2",g*2);k("lineSpace3",g*2);k("arrowL",h/6);k("arrowD",h/10);k("opSpace",h/10)};d.getStyle=function(g){return d.styles[g]||d.stdStyle};d.getStyleCol=function(h,g){var k=d.getStyle(h);if(g&&g!=k.color){return{fnt:k.fnt,col:g}}return k}}function _chemGrBuilder(u,d,J){var G=J.stdStyle,P=J.line,A=J.lineWidth||1,w=A*2,ab=new GrFrame(),O=[],ae,l,U,k,K,o=G.col,R=[],g,V,r=[];function y(ak){return ak.length?ak[ak.length-1]:0}function F(ak){return ak.color||o}function ah(){return A*7}function X(ak){return l[ak.index]}var Z={C:5,H:3,_R:4};function t(al){var ak=0,an=0,ao=0,am;al.walk({itemPre:function(){am=1},atom:function(ap){am=Z[ap.id]||Z._R},custom:function(){am=2},radical:function(){am=Z._R},itemPost:function(ap){if(ap.bCenter){am=6}if(am>ao){ao=am;an=ak}ak++}});return an}function ac(am){var ak=am.figs[0],al=new Point();if(ak){al.x=(ak.bounds.A.x+ak.bounds.B.x)/2;al.y=(ak.font.descent+ak.font.ascent)/2}return al}function I(au,at,am,ak){var ap=au.subx(at),ao=ap.length(),an,al=new GrLines(am||o,A),ar=J.arrowL,aq=at.clone();ap.muli(ar/ao).addi(at);an=e(at,ap,J.arrowD,ar);al.add(aq);al.add(an[0]);al.add(aq,1);al.add(an[1]);ak.addFig(al)}function L(aq,al){var ao=aq.tx,an,at,am;if(ao=="-"||ao=="+"){an=new GrLines(al.col,A);an.cap="square";an.addA([0,0,1,at=al.fnt.textWidth("-"),0,0]);if(ao=="+"){am=at/2;an.addA([am,-am,1,am,am,0])}an.bounds.grow(A);an.yt=an.bounds.A.y;an.yb=an.bounds.B.y}else{an=new GrText(aq.tx,al.fnt,al.col);an.yt=an.font.descent;an.yb=an.font.ascent}if(!aq.bRound){return an}var ar=new GrFrame();var ap=Math.max(an.bounds.W(),an.yb-an.yt)+A*4,ak=new GrEllipse(ap-A*2,ap-A*2,0,al.col,A);ak.org.init(A,A);an.org.x=-an.bounds.A.x+(ap-an.bounds.W())/2;an.org.y=-an.yt+(ap-(an.yb-an.yt))/2;ar.addFig(ak,1);ar.addFig(an,1);ar.update();ar.yt=0;ar.yb=ap;return ar}function S(an,ap){if(!an){return}var ak=y(ap.frames);var am=J.getStyleCol("NodeCharge",g);var ao=L(an,am);ap.add(ao);if(an.bLeft){ao.org.x=ap.bounds.A.x-ao.bounds.W()}else{ao.org.x=ak.org.x+ak.ir}ao.org.x-=ao.bounds.A.x;var al=ao.yb-ao.yt;ao.org.y=ap.bounds.A.y+ak.it-ao.yt-al*J.supKY;ap.update()}function ag(ak,an,al,ap){if(!an||(an.bLeft^ap)){return 0}var am=J.getStyleCol("NodeCharge",al);var ao=L(an,am);ak.cf=ao;ak.cl=ap;return ao.bounds.W()}function ai(ak,al,an){var am=ak.cf;if(am){if(an){am.org.x=al.org.x+al.bounds.A.x-am.bounds.B.x-A}else{am.org.x=al.org.x+al.bounds.B.x+am.bounds.A.x+A}am.org.y=al.org.y+al.bounds.A.y-am.bounds.A.y-am.yt-J.bracketSupKY*(am.yb-am.yt);ae.add(am)}}function C(am){var ak=0,al=r.length;while(ak<al&&!r[ak].S[am]){ak++}return ak==al?-1:ak}function q(al){var an=al.sc,ak=C(an),am;if(ak<0){am={L:[al],S:{}};am.S[an]=1;r.push(am)}else{r[ak].L.push(al)}}var B=[];function Q(al,ak){return al.org.addx(al.bounds[ak?"A":"B"].x,0)}function s(al,ak){return Q(al,!ak)}function c(al){B.length=0;var aC=new Point(),au=0,ax,ar,am,ap,at=[],aw=al.cmds;function ao(aE){var aF={x:aC.x,y:aC.y,f0:ar,f1:am,w:aE};return B[ap]=aF}function aq(aE){au=aE.nodes[0];ax=aE.nodes[1];ar=X(au);am=X(ax)}function aB(){var aN=C(au.sc),aI=C(ax.sc);if(aN==aI||aN<0||aI<0){return}var aE=r[aN],aL=r[aI],aJ,aG,aF;for(aJ in aL.S){aE.S[aJ]=1}var aM=aC.x<0,aK=Q(ar,aM).addx(aC);var aH=s(am,aM).negi().addi(aK);for(aJ in aL.L){aG=aL.L[aJ];aE.L.push(aG);aF=X(aG);aF.org.addi(aH)}r.splice(aI,1)}function aA(aJ){var aF,aI,aG=ah(),aE,aH=aJ.bond;aq(aH||aJ);aI=ao(aG);aI.cw=aE=ag(aI,aJ.end.charge,F(aJ),1);aG+=aE;if((!aH&&!au)||(aH&&!aH.soft)){at.push(aI);for(aF in at){at[aF].x-=aG}aI.f0=0}else{aC.x+=aG}}function an(aF){var aI=ah(),aS=aF.bond,aQ,aH,aL=0;aq(aS||aF);if(aF.n!=1){var aG=J.getStyleCol("BracketCnt",aF.color);aQ=new GrText(aF.n,aG.fnt,aG.col);aL+=aQ.bounds.W()}var aM=ao(aI);aM.k=aQ;aM.cw=aH=ag(aM,aF.charge,F(aF));var aK=ap-1,aO=0,aR=new Rect();while(aK>=0&&!aO){aw[aK].walk({bracketBegin:function(aU){if(aU.end==aF){aO=aU;B[ap].yt=B[aK].yt=aR.A.y;B[ap].yb=B[aK].yb=aR.B.y}},nodePre:function(aV){var aW=X(aV),aU=aW.bounds.clone();aU.move(aW.org);if(aU.is0()){aU.grow(P*0.2)}aR.unite(aU)}});aK--}var aP=aR.B.x-(ar.org.x+ar.bounds.B.x),aN=X(aO.nodes[1]),aE=aN.org.x+aN.bounds.A.x-aR.A.x;if(!is0(aE)){var aJ=aK+1;if(aS&&aS.soft){for(aK+=2;aK<ap;aK++){aw[aK].walk({nodePre:function(aV){var aU=X(aV);aU.org.x+=aE}})}}if(!(aO.bond&&aO.bond.soft)){B[aJ].x-=aE}}if(ax&&(!aS||!aS.soft)){}var aT=Math.max(aL,aH)+aP;aC.x+=aI+aT;aM.x+=aP}function ay(aE){return aE.walk({nodePre:function(aF){return 1}})}function aD(aH){var aG,aM,aJ,aF=0,aE;aG=aM=+ap;while(aG>=0&&!ay(aw[aG])){aG--}while(aM<aw.length&&!ay(aw[aM])){aM++}if(aG<0||aM>=aw.length){return}aq({nodes:[aw[aG],aw[aM]]});aE=J.getStyleCol("std",o);aJ=new GrText(J.$MulChar||"*",aE.fnt,aE.col);if(aH.n!==1){aE=J.getStyleCol("MultiK",o);aF=new GrText(aH.n,aE.fnt,aE.col);aF.org.x-=aF.bounds.W()}var aI,aK=J.opSpace,aL=aK*2+aJ.bounds.W();if(aF){aL+=aF.bounds.W()}aJ.org.x+=aK;aJ.org.y-=aJ.font.descent+(aJ.font.ascent-aJ.font.descent)/2;aI=ao(aL);aI.m=aJ;aI.k=aF;aI.s=aK;aC.x+=aL}function av(){at.length=0;if(au){aB();au=0}}var az=0;function ak(aI){av();if(az){aC.init(0,0)}az=aI.brk;if(!aI.soft){return}aq(aI);var aE=C(au.sc),aG=C(ax.sc);if(aE==aG){return}var aH=ao(),aJ=aI.pt.x<0;var aF=aH.d=new Point(aI.pt.x*J.horizLine,aI.pt.y*P*(aJ?-1:1));aC.addi(aF)}for(ap in aw){aw[ap].walk({bond:ak,bracketBegin:aA,bracketEnd:an,mul:aD,nodePre:function(){av();aC.init(0,0)}})}av()}function f(ak){if(!ak){return A}if(ak==1){return J.thickWidth}return A+(J.thickWidth-A)*ak}function ad(an,ak,al){var am=new GrLines(ak||F(an),al||f(an.w0));am.cap="round";am.join="round";return am}var x=[];function v(al,ak){if(ak===undefined){ak=al.w0||0}return F(al)+":"+ak}function E(){var al,ak,an,am,ao;for(al in x){an=x[al];am=an.p;ao=ad(an.b,0,an.w);for(ak in am){ao.add(am[ak])}ae.addFig(ao)}x.length=0}function m(ap,ao,at,ak){var an=0,al=x.length,au,ar,am,aq=v(at,ak);while(an<al){au=x[an];if(au.k==aq){ar=au.p;am=y(ar);if(am.equals(ap)){ar.push(ao);break}else{if(am.equals(ao)){ar.push(ap);break}else{if(ar[0].equals(ap)){ar.unshift(ao);break}else{if(ar[0].equals(ao)){ar.unshift(ap);break}}}}}an++}if(an==al){x.push({b:at,k:aq,w:ak,c:F(at),p:[ap,ao]})}}function b(an,am,al,ak){m(an,am,al,ak)}function e(an,al,am,ak){var aq=al.subx(an),ao,ap;if(!ak){ak=aq.length()}ao=aq.x;aq.x=-aq.y;aq.y=ao;aq.muli(am/ak);ap=aq.mulx(-1);aq.addi(al);ap.addi(al);return[aq,ap]}function T(an,al,am,ak){var ap=al.subx(an),ao;if(!ak){ak=ap.length()}ao=ap.x;ap.x=-ap.y;ap.y=ao;ap.muli(am/ak);return ap.addi(al)}function aa(ao,an,am){var al=new GrLines(),ak=e(ao,an,J.thickWidth/2);al.fillColor=F(am);al.add(ao);al.add(ak[0]);al.add(ak[1]);if(J.lineWidth){al.join="round";al.color=al.fillColor;al.width=A;al.add(ao)}ae.addFig(al)}function M(am,ak,ao){var aF=ad(ao,0,A),aE=J.thickWidth/2,aC=am.dist(ak),an=e(am,ak,aE,aC),aq=e(ak,am,-aE,aC),aB=0,ax=Math.floor(aC/J.hatch)+1,av=aq[0],aw=an[0].subi(av).muli(1/aC),ay=aq[1],aA=an[1].subi(ay).muli(1/aC),au,at,az=aC/ax,aD,ap=az/2;for(;aB<ax;aB++){aD=aB*az+ap;au=aw.mulx(aD).addi(av);at=aA.mulx(aD).addi(ay);aF.add(au,1);aF.add(at)}ae.addFig(aF)}function H(an,am,aq){var aG=ad(aq),ao=e(an,am,J.thickWidth/2),at=e(am,an,A/2),aw=at[1],aA=at[0],aF=ao[0],ak=ao[1],ax=aw.subi(aF),aB=aA.subi(ak),aC=ax.length(),aE=aB.length(),ap=J.hatch,aD=0,ay=Math.floor((aC+aE)/2/ap),az=1/ay,au,av;for(;aD<ay;aD++){av=ax.mulx(aD*az).addi(aF);au=aB.mulx(aD*az).addi(ak);aG.add(av,1);aG.add(au)}ae.addFig(aG)}function n(au,at,av){var ak,ap=at.subx(au),ao=ap.length(),an=J.dash,am=0,al,ar,aq;if(ao<an*2){return m(au,at,av)}al=Math.floor(ao/an);if(!(al&1)){al++}an=ao/al;ak=ad(av);for(;am<al;am+=2){ar=ap.mulx(am*an/ao).addi(au);aq=ap.mulx((am+1)*an/ao).addi(au);ak.add(ar,1);ak.add(aq)}ae.addFig(ak)}function af(ay,ax,az){var ak=ad(az,0,A),an,aw=ay,av,ap,ao,ar=ax.subx(ay),aq=ar.length(),am=P/8,al=P/6,at=Math.floor((aq+al/2)/al),au=ar.mulx(am/aq);aq/=at;ar.muli(1/at);ak.add(aw);for(an=0;an<at;an++){av=aw.addx(ar);if((an&1)==0){ap=aw.addx(au.y,-au.x)}else{ap=aw.addx(-au.y,au.x)}ao=ap.addx(ar);ak.add(ap,2);ak.add(ao,2);ak.add(av);aw=av}ae.addFig(ak)}function z(av,ap,an){var aG,ay="|",aw=av.N;if(av.style){ay=av.style}else{if(aw==0){ay=0}else{if(aw==2){ay=av.w0?"II":"||"}else{if(aw==3){ay="|||"}}}}if(!ay){return}if(ay=="~"){return af(ap,an,av)}if(ay=="|"){if(av.w0||av.w1){if(av.w0==0&&av.w1==1){aa(ap,an,av)}else{if(av.w0==1&&av.w1==0){aa(an,ap,av)}else{if(av.w0==0&&av.w1==-1){H(ap,an,av)}else{if(av.w0==-1&&av.w1==0){H(an,ap,av)}else{if(av.w0>0&&av.w0==av.w1){b(ap,an,av)}else{if(av.w0<0&&av.w0==av.w1){M(ap,an,av)}}}}}}}else{b(ap,an,av)}return}function ax(al){return al=="I"?J.thickWidth:A}function aL(aO,aN,al,ar){if(al=="I"){b(aO,aN,ar,ax(al))}else{if(al==":"){n(aO,aN,ar)}else{if(al!="0"){b(aO,aN,ar,A)}}}}function aC(){if(av.cross){return 0}function ar(a0,aY){var a5,aT,a7=X(a0).org,a6=X(aY).org,a3=a6.subx(a7),aX,a1,a4,a2,aV,aU,aZ=aY.bonds,aW=100,aS=-100;for(aX in aZ){a5=aZ[aX];aT=(a5.style&&a5.style.length==1)||a5.N==1;if(aT&&(aV=a5.other(aY))){if(aV!=a0){a4=X(aV).org;a1=a4.subx(a7);a2=a3.x*a1.y-a1.x*a3.y;if(a2>0){aU=-1}else{if(a2<0){aU=1}else{aU=0}}aW=Math.min(aW,aU);aS=Math.max(aS,aU)}}}if(aW==100){aW=aS=0}return[aW,aS]}var aO=av.nodes,al=ar(aO[0],aO[1]),aP=ar(aO[1],aO[0]),aQ=0,aN=al[0],aR=aP[0];if(aN&&aN==al[1]){if(aN>0&&aR<0){aQ=-1}else{if(aN<0&&aP[1]>0){aQ=1}else{if(!aR&&!aP[1]){aQ=-aN}}}}else{if(aR&&aR==aP[1]){if(aR<0&&al[1]>0){aQ=-1}else{if(aR>0&&aN<0){aQ=1}else{if(!aN&&!al[1]){aQ=aR}}}}}return aQ}var aI=ay.length,aH=ap.dist(an);if(aI==2){var am=av.align,aF=0,aq=0;switch(am){case"x":aq=1;break;case"l":aF=-1;break;case"r":aF=1;break;case"m":break;default:aF=J.flDblAlign&&aC()}function aA(al){var ar=av.nodes[al];return ar.bAuto&&ar.bonds.length>1}var ao=ax(ay[0]),au=ax(ay[1]),aJ=J.lineSpace2,aB,aE,aM,ak,aK,aD,az;switch(aF){case -1:aB=ap;aM=an;aD=aJ+(ao+au)/2;ak=T(ap,an,-aD,aH);aE=T(an,ap,aD,aH);aK=ak.subx(aE).muli(aD/aH);if(aA(0)){aE.addi(aK)}if(aA(1)){ak.subi(aK)}break;case 1:aE=ap;ak=an;az=aJ+(ao+au)/2;aM=T(ap,an,az,aH);aB=T(an,ap,-az,aH);aK=aM.subx(aB).muli(az/aH);if(aA(0)){aB.addi(aK)}if(aA(1)){aM.subi(aK)}break;default:az=(aJ+ao)/2;aD=(aJ+au)/2;aM=T(ap,an,az,aH);ak=T(ap,an,-aD,aH);aB=T(an,ap,-az,aH);aE=T(an,ap,aD,aH)}aL(aB,aM,ay[0],av);aL(aE,ak,ay[1],av)}else{if(aI==3){var aJ=J.lineSpace3,au=ax(ay[2]),at=ax(ay[1]),ao=ax(ay[0]),aD=aJ+(au+at)/2,az=aJ+(ao+at)/2,aM=T(ap,an,az,aH),ak=T(ap,an,-aD,aH),aB=T(an,ap,-az,aH),aE=T(an,ap,aD,aH);aL(aE,ak,ay[2],av);aL(ap,an,ay[1],av);aL(aB,aM,ay[0],av)}else{aL(ap,an,ay,av)}}}function aj(ao){var aq,ak=ao.cmds;function av(aJ){var az=aJ.nodes,aD=az.length;if(aJ.ext=="o"){var aE,aC,aB,aI,ay,ax=new Point(),aF=[];for(aE in az){aB=X(az[aE]);aF.push(aI=aB.org);ax.addi(aI)}ax.muli(1/aD);aI=aF[0].addx(aF[1]).muli(0.5);ay=ax.dist(aI)*0.7;aC=new GrEllipse(ay*2,ay*2,0,F(aJ),A);aC.org=ax.addi(-ay);ae.addFig(aC)}if(aJ.ext=="s"&&aD>1){var aC,aE,aG,aA,ax=new Point(),aH=[];for(aE in az){aH.push(aA=X(az[aE]).org.clone());ax.addi(aA)}ax.muli(1/aH.length);aE=0;if(!aJ.o){aE++;aD--}for(;aE<aD;aE++){aA=aH[aE];aG=ax.subx(aA);aA.addi(aG.muli(0.2))}BSplineExt(aH,aJ.o);aC=createBSpline(aH,J.dash,F(aJ),A,aJ.style==":");ae.addFig(aC);am(aJ,0,aH[1],aH[2]);am(aJ,1,aH[aH.length-4],aH[aH.length-3])}}function ar(aB,aA,az,ay){if(aB.bAuto){return}if(ChemSys.isEmptyNode(aB)){return}var ax,aC;for(i in aA.frames){iframe=aA.frames[i];for(j in iframe.figs){fig=iframe.figs[j];org=fig.org.addx(iframe.org).addi(aA.org);pa=fig.bounds.A.addx(org);pb=fig.bounds.B.addx(org);if(font=fig.font){pb.y=pa.y+font.ascent;pa.y+=font.descent}pa.addi(-A,-A);pb.addi(A,A);if(ay.x>az.x){ax=pb.x;if(az.x<ax){aC=(ax-az.x)*(ay.y-az.y)/(ay.x-az.x)+az.y;if(pa.y<aC&&aC<pb.y){az.x=ax;az.y=aC}}}else{ax=pa.x;if(ax<az.x){aC=(ax-az.x)*(ay.y-az.y)/(ay.x-az.x)+az.y;if(pa.y<aC&&aC<pb.y){az.x=ax;az.y=aC}}}if(ay.y>az.y){aC=pb.y;if(az.y<aC){ax=(aC-az.y)*(ay.x-az.x)/(ay.y-az.y)+az.x;if(pa.x<ax&&ax<pb.x){az.x=ax;az.y=aC}}}else{aC=pa.y;if(aC<az.y){ax=(aC-az.y)*(ay.x-az.x)/(ay.y-az.y)+az.x;if(pa.x<ax&&ax<pb.x){az.x=ax;az.y=aC}}}}}}function an(aH,aG,aF){var aA=aG.dist(aF)/aH.pt.length(),aB,aE,az=aH.midPt,ay=az.length,aD=aG,aC,ax=new GrLines(F(aH),A);ax.add(aD);for(aB=0;aB<ay;aB++){aE=az[aB];aC=aE.mulx(aA).addi(aD);ax.add(aC,aB==ay-1?0:2);aD=aC}ae.addFig(ax)}function am(ay,ax,aA,az){if(ax){if(ay.arr1){I(aA,az,ay.color,ae)}}else{if(ay.arr0){I(az,aA,ay.color,ae)}}}function ap(aM){var aF=B[aq];if(aF){var aH=aM.pt.x<0,az=aH?-1:1,aL=Q(aF.f0,aH).addi(aF),aJ=aL.addx(aF.d),aI=aF.d.x,aB=J.lineWidth||1;aL.x+=aB*az;aJ.x-=aB*az;z(aM,aL,aJ)}else{if(aM.nodes.length!=2){av(aM)}else{var aN=aM.nodes[0],aK=aM.nodes[1],aE=X(aN),aD=X(aK),aA=aM.midPt,aL=aE.org.clone();if(aA){var aC,ay,aG=[aL],ax=new GrLines(F(aM),A);for(aC in aA){aG.push(aA[aC].mulx(P).addi(aG[aC]))}ay=aG.length;ar(aN,aE,aG[0],aG[1]);ar(aK,aD,aG[ay-1],aG[ay-2]);am(aM,0,aG[0],aG[1]);am(aM,1,aG[ay-2],aG[ay-1]);for(aC=0;aC<ay;aC++){ax.add(aG[aC],aC==0?1:(aC==ay-1?0:2))}ae.addFig(ax)}else{var aJ=aD.org.clone();ar(aN,aE,aL,aJ);ar(aK,aD,aJ,aL);z(aM,aL,aJ);am(aM,0,aL,aJ);am(aM,1,aL,aJ)}}}}function at(aA,aE,az,aC,ay){var aB=aC-aE,aD=Math.abs(az-aA)/3,aF,ax;if(aA<az){ax=aA+w;aF=A}else{aF=-A;ax=aA-w}fig=new GrLines();fig.fillColor=F(ay);fig.addA([az,aE,1,aA,aE+aD,2,aA,aE+aB/3,2,aA,aE+aB/2,0,aA,aC-aB/3,2,aA,aC-aD,2,az,aC,0,az+aF,aC-A,0,ax,aC-aD-A,2,ax,aC-aB/3,2,ax,aE+aB/2,0,ax,aE+aB/3,2,ax,aE+aD+A,2,az+aF,aE+A,0]);return fig}function au(az){var aF=B[aq];if(!aF){return}var aB,aE=aF.f0,aD=aF.f1,aK;if(aE){aK=Q(aE)}else{aK=s(aD)}aK.addi(aF);var aI=ah(),aC=aK.x+aF.cw,aA=aC+aI,ay=aC,aJ=aF.yt,aG=aF.yb;aC+=A;ay+=3*A;aA-=A;if(az.tx=="("){aB=at(aC,aJ,aA,aG,az)}else{aB=new GrLines();aB.fillColor=F(az);aB.cap=aB.join="square";var aH=aJ+A,ax=aG-A;aB.addA([aA,aJ,1,aC,aJ,0,aC,aG,0,aA,aG,0,aA,ax,0,ay,ax,0,ay,aH,0,aA,aH,0])}ae.addFig(aB);ai(aF,aB,1)}function al(aK){var aO,aM=B[aq];if(!aM){return}var aL=aM.f0;var aD=ah(),aF=Q(aL).addi(aM),aJ=aF.x,aI=aJ+aD,az=aI,aG=aM.yt,ax=aM.yb;aJ+=A;aI-=A;az-=3*A;if(aK.tx==")"){aO=at(aI,aG,aJ,ax,aK)}else{aO=new GrLines(0,0);aO.fillColor=F(aK);aO.cap=aO.join="square";var aB=aG+A,ay=ax-A;aO.addA([aJ,aG,1,aI,aG,0,aI,ax,0,aJ,ax,0,aJ,ay,0,az,ay,0,az,aB,0,aJ,aB,0])}ae.addFig(aO);ai(aM,aO);if(aO=aM.k){var aE=aO.font,aN=aE.descent,aC=aE.ascent,aH=aC-aN,aA=aE.height-aC;aO.org.init(aI+A,ax-aA-aH+aH*J.bracketSubKY);ae.addFig(aO)}}function aw(aA){var ax=B[aq],ay=ax.s,aB=ax.f0,az=Q(aB).addi(ax);ax.m.org.addi(az);ae.addFig(ax.m);if(ax.k){ax.k.org.addi(ax.f1.bounds.A).addi(ax.f1.org);ae.addFig(ax.k)}}for(aq in ak){ak[aq].walk({bond:ap,bracketBegin:au,bracketEnd:al,mul:aw})}}function Y(ao,al,ak){var am=J.getStyleCol(al,ak||g),an=new GrText(ao,am.fnt,am.col);K.addFig(an);K.irc=an.getIrc()}function D(ap,am,ao){var ak=null,an=null,al,an;if(!is0(am.x)){al=am.x<0?ao.A.x:ao.B.x;al-=ap.x;an=al*am.y/am.x}if(!is0(am.y)){yv=am.y<0?ao.A.y:ao.B.y;yv-=ap.y;ak=yv*am.x/am.y}if(ak===null){am.init(al,an)}else{if(an===null){am.init(ak,yv)}else{if(al*al+an*an<ak*ak+yv*yv){am.init(al,an)}else{am.init(ak,yv)}}}am.addi(ap)}function h(am,at,ak,aq){am.update();var au=am.getIrc().clone();au.grow(ak);var ar=au.center(),an=au.H()/au.W(),ap,ao,al;for(ao in at){ap=new Point();ap.fromDeg(at[ao]);ap.y*=an;D(ar,ap,au);aq(ar,ap)}}function N(al,am,ak){h(al,am,P*0.1+A,function(aq,ap){var ao=A*3,an=new GrEllipse(ao,ao,ak);an.org.addi(ap).subi(ao/2);al.addFig(an)})}function W(am,al,ak){h(am,al,P*0.05,function(au,at){var ap=new GrLines(ak,A),ar=at.subx(au);ap.cap="butt";var ao=Math.min(Math.abs(at.x-au.x),Math.abs(at.y-au.y)),an=ar.length();ar.muli(1-0.4*ao/an);var aq=e(au,au.addx(ar),P/6);ap.add(aq[0]);ap.add(aq[1]);am.addFig(ap)})}u.walk({agentPre:function(ak){O.push(ae=new GrFrame());l=[];r=[]},agentPost:function(ak){c(ak);aj(ak);E();ae.update()},nodePre:function(ak){ae.addFr(U=new GrFrame());l[ak.index]=U;U.org=ak.pt.mulx(P);nextItemX=0;q(ak);k=ak.bAuto},nodePost:function(ap){if(k){return}var ak=0,an,am,aq,al=U.frames;for(an in al){aq=al[an];aq.org.x=ak;ak+=aq.bounds.R()}am=t(ap);var ao=al[am];cpt=ac(ao).addi(ao.org);cpt.negi();U.moveChilds(cpt);U.update();S(ap.charge,U)},itemPre:function(ak){if(k){return}R.push(o);o=ak.color||G.col;g=ak.itemColor||o;V=ak.atomColor||g;K=new GrFrame();U.addFr(K)},itemPost:function(aq){if(k){return}o=R.pop();K.update();K.ir=K.bounds.B.x;var am=K.figs[0];K.it=am?am.org.y+am.font.descent:new Point();if(aq.n!=1){var ao=J.getStyleCol("ItemCnt",g),ap=new GrText(aq.n,ao.fnt),al=ao.fnt.descent,ak=ao.fnt.ascent;ap.color=ao.col;ap.org.x=K.bounds.R();ap.org.y=K.figs[0].font.ascent-ak+J.subKY*(ak-al);K.addFig(ap);K.update()}if(aq.charge){var ao=J.getStyleCol("ItemCharge",g),ap=new GrText(aq.charge.tx,ao.fnt,ao.col),an=K.getIrc();ap.org.y=an.A.y-ap.bounds.H();ap.org.x=(an.A.x+an.B.x)/2-ap.bounds.W()/2;K.addFig(ap);K.update()}if(aq.dots){N(U,aq.dots,g)}if(aq.dashes){W(U,aq.dashes,g)}},atom:function(ak){if(k){return}Y(ak.id,"Atom",V)},radical:function(ak){Y(ak.label,"Radical")},comm:function(ak){Y(ak.tx,"Comment")},custom:function(ak){Y(ak.tx,"Custom")},operation:function(at){function ak(aE){var aF=0,aD;if(aE){aD=J.getStyleCol("OpComment",o);aF=new GrText(aE.tx,aD.fnt,aD.col)}return aF}var aB=new GrFrame(),aC,az=J.getStyleCol("op",at.color||o),au=at.dstText,ar=[ak(at.commentPre),ak(at.commentPost)],ax,aq,aA;if(au=="—→"){aq=P*1.4;for(ax=0;ax<2;ax++){if(ar[ax]){aq=Math.max(aq,ar[ax].bounds.W())}}aq+=J.arrowL*3;var am=new Point(),al=am.addx(aq,0);aC=new GrLines(az.col,A);aC.add(am);aC.add(al);aB.addFig(aC);I(am,al,az.col,aB);aB.cy=0;aB.bounds.grow(0,w)}else{if(at.srcText=="<==>"){aq=P*1.4;for(ax=0;ax<2;ax++){if(ar[ax]){aq=Math.max(aq,ar[ax].bounds.W())}}aq+=J.arrowL*3;aC=new GrLines(az.col,A);var ao=J.arrowL,aw=J.arrowD,ap=w;aC.addA([0,-ap,1,aq,-ap,0,aq-ao,-ap-aw,0,aq,ap,1,0,ap,0,ao,ap+aw,0]);aC.join="miter";aB.addFig(aC);aB.cy=0;aB.bounds.grow(0,w)}else{aC=new GrText(au,az.fnt,az.col);aB.addFig(aC);aB.irc=aC.getIrc();aB.cy=aB.irc.cy()}}var ay=aB.getIrc(),av;for(ax=0;ax<2;ax++){if(aA=ar[ax]){aA.org.init((ay.A.x+ay.B.x-aA.bounds.W())/2,ax?ay.B.y-aA.font.descent:(ay.A.y-aA.bounds.H()));aB.addFig(aA,1);var an=aA.getIrc();an.move(aA.org)}}aB.update();O.push(aB)}});function p(){var am,aq=O.length,ap,ak=0,an,al=J.opSpace;function ao(ar){var at=("cy" in ar)?ar.cy:(ar.bounds.A.y+ar.bounds.B.y)/2;return at+ar.org.y}for(am=0;am<aq;am++){ap=O[am];ap.org=ap.bounds.A.negx();ap.org.x+=ak;if(am){ap.org.y-=ao(ap)-an}else{an=ao(ap)}ak+=ap.bounds.W()+al;ab.addFr(ap)}ab.update()}p();return ab}ChemJQ={draw:function(e,b,c){var g=jQuery(b).empty();if(e.isOk&&!e.isOk()){return}var d=new IsNonText();e.walk(d);if(d.ok){var f=c?c.data("drawsys"):null;ChemSys.view(e,g[0],null,f)}else{g.html(ChemSys.makeHtml(e))}},autoCompileSingle:function(b,c){var d=$(b).text();this.draw(ChemSys.compile(d),b,c)},autoCompile:function(b){b=b||".echem-formula";jQuery(b).each(function(){ChemJQ.autoCompileSingle(this)})},autoCompileCfg:function(c,b){b=b||".echem-formula";jQuery(b).each(function(){ChemJQ.autoCompileSingle(this,c)})}};if("jQuery" in window){jQuery(function(){var b=$(".easyChemConfig,.CharChemConfig,body.echem-auto-compile").filter(":last");if(b.length){ChemJQ.autoCompileCfg(b)}})}var ChemEqDict={ru:{"[E] is missing in [S] part":"Отсутствует элемент [E] в [S] части уравнения.","left|part":"левой","right|part":"правой","Equation not specified":"Уравнение не задано","No separating operation":"Требуется одна операция, разделяющая левую и правую часть уравнения.","No solution":"Не удалось найти решение","Cant balance expression with abstract koefficients":"Невозможно балансировать уравнение с абстрактными коэффициентами"},en:{"[E] is missing in [S] part":"Element [E] is missing on the [S] side of the equation.","left|part":"left","right|part":"right","Equation not specified":"The equation is not specified","No separating operation":"Requires a single operation, separating the left and right side of the equation.","No solution":"Could not find a solution."}};function ChemEquation(d){function B(N){var K={},M,L,O=N.length;for(L=0;L<O;L++){M=N[L];K[M.getKey()]=M.n}return K}if(ChemEqDict){ChemSys.addDict(ChemEqDict);ChemEqDict=null}function q(K,L){this.x=K||0;this.y=L||1}q.prototype={toString:function(){if(this.y==1){return this.x+""}return this.x+"/"+this.y},copy:function(){return new q(this.x,this.y)},set:function(K){this.x=K;this.y=1},isEmpty:function(){return this.x==0},aless:function(K){return Math.abs(this.x)*K.y<Math.abs(K.x)*this.y},sign:function(){if(this.x<0){return -1}if(this.x>0){return 1}return 0},negx:function(){return new q(-this.x,this.y)},absx:function(){return new q(Math.abs(this.x),this.y)},addi:function(K){if(v(K)){this.x+=K*this.y}else{if(this.y==K.y){this.x+=K.x}else{this.x=this.x*K.y+K.x*this.y;this.y*=K.y;this.norm()}}return this},addx:function(K){if(v(K)){return new q(this.x+K*this.y,this.y)}else{return this.copy().addi(K)}},subi:function(K){return this.addi(K.negx())},subx:function(K){return K.negx().addi(this)},muli:function(K){if(v(K)){this.x*=K}else{this.x*=a.x;this.y*=a.y;this.norm()}return this},mulx:function(K){if(v(K)){return new q(this.x*K,this.y)}else{var L=new q(this.x*K.x,this.y*K.y);return L.norm()}},divi:function(K){this.x*=K.y;this.y*=K.x;return this.norm()},divx:function(K){var L=new q(this.x*a.y,this.y*a.x);return L.norm()},norm:function(){if(this.y<0){this.x=-this.x;this.y=-this.y}if(this.x==0){this.y=1}else{if(this.x<1||this.x>1){var K=o(this.x,this.y);this.x/=K;this.y/=K}}return this}};function v(K){return typeof K=="number"}function o(M,L){var K=Math.min(Math.abs(M),Math.abs(L));while(K>1){if(M%K==0&&L%K==0){break}K--}return K}var G=0,u=1,D=2,p,f,k,r,x=0,w=0,g=[],e=[],J=[],A=[];function z(K,L,M){p=K;k=L;r=M||0}function y(){z(G,"Not solved");g=[];f=null;J=[];A=[]}this.init=function(K){y();var Q=typeof K,Y="Invalid expression";if(!K){return z(u,Y)}if(Q=="string"){f=ChemSys.compile(K)}else{if(Q=="object"&&K.isOk){f=K}}if(!f||!f.isOk()){return z(u,Y)}var P=0,M=0;f.walk({itemPre:function(ae){var ad=+ae.n;P=P||isNaN(ad);if(ad){M=M||Math.floor(ad)!=ad}}});if(P){return z(u,"Cant balance expression with abstract koefficients")}if(M){return z(u,"Cant balance expression with non-integer koefficients")}var W,V,O,aa,ab=createElemList(),S=[];f.walk({agentPre:function(af){g.push(af);var ag=af.part;while(S.length<ag+1){S[ag]=createElemList()}var ae=new ElemListMaker();af.walk(ae);var ad=ae.result();ab.addList(ad);S[ag].addList(ad)}});x=g.length;if(S.length!=2){return z(u,"No separating operation")}ab=B(ab);S[0]=B(S[0]);S[1]=B(S[1]);for(V=0;V!=2;V++){O=S[V];aa=S[V^1];for(W in O){if(!aa[W]){var T=ChemSys.lang((V==0?"right":"left")+"|part");return z(u,"[E] is missing in [S] part",{E:W,S:T})}}}var R={},ac,U;V=0;for(ac in ab){R[ac]=V++}w=V;var N=[];for(V=0;V!=w;V++){J.push([])}for(V=0;V!=x;V++){for(W=0;W!=w;W++){N[W]=new q()}var L=g[V],X=B(ElemListMaker.create(L));for(W in X){U=R[W];var Z=X[W];if(L.part==1){Z=-Z}N[U].set(Z)}for(W in J){J[W].push(N[W])}}for(V=0;V!=x;V++){e[V]=new q()}};this.solve=function(){while(p==G){this.calcStep()}};this.calcStep=function(){if(p!=G){return}var K,L,N,M;if(A.length==x-1){return m()}for(K in J){N=[];M=J[K];for(L=0;L!=x;L++){if(!M[L].isEmpty()){N.push(L)}}if(N.length==2&&M[N[0]].sign()!=M[N[1]].sign()){return t(K,N[0],N[1])}if(N.length==0){J.splice(K,1);return}}if(s()){return}if(n()){return}z(u,"Balance is not found")};this.isOk=function(){return p==D};this.getMessage=function(){return ChemSys.lang(k,r)};this.getExpr=function(){return f};function H(L,K){this.srcCol=L;this.k=K}function E(K){this.dstCol=K;this.refs=[]}function s(){if(J.length<2){return false}var O,R,Q=0,P=0,N,W,U,T,S=J.length,K;for(;;++P){N=P;++N;if(N==S){return 0}U=J[P];for(;N!=S;++N){T=J[N];for(Q=0;Q!=x;Q++){if(!U[Q].isEmpty()&&!T[Q].isEmpty()){break}}if(Q!=x){break}}if(N!=S){break}}U=J[P];T=J[N];var M=new q(-1).divi(U[Q]),L=new q(-1).divi(T[Q]),V=new E(Q);for(R=0;R!=x;R++){if(R==Q||U[R].isEmpty()){continue}V.refs.push(new H(R,U[R].mulx(M)))}if(V.refs.length==0){return 0}A.unshift(V);for(R=0;R!=x;R++){T[R]=U[R].mulx(M).subi(T[R].mulx(L))}J.splice(P,1);N--;S--;for(P=0;P!=S;++P){if(P==N){continue}W=J[P];O=W[Q].copy();W[Q].set(0);for(R in V.refs){K=V.refs[R];W[K.srcCol].addi(O.mulx(K.k))}}return 1}function l(){var L,K,N=[],M=[];for(L=0;L!=x;L++){N[L]=0}for(L in A){K=A[L];N[K.dstCol]=1}for(L=0;L!=x;L++){if(!N[L]){M.push(L)}}return M}function C(N,L){var M,K=N.length;for(M=0;M!=K;M++){e[N[M]].set(L[M])}c();if(!b()){return false}F();if(!I()){return false}h();return true}function n(){var O,R=l(),S=R.length,Y=50,U=[];for(O=0;O!=S;O++){U[O]=1}if(C(R,U)){return 1}var K=[],Q=[],T=1<<S,V,P,Z,X,W;for(V=2;V<=Y;V++){for(Z=1;Z!=T;Z++){Q=[];for(O=0,X=1;X!=T;X<<=1,O++){if((Z&X)==0){Q.push(O)}else{U[O]=V}}W=Q.length;for(O=0;O!=W;O++){K[O]=1}do{P=0;for(O=0;O!=W;O++){U[Q[O]]=K[O]}if(C(R,U)){return 1}while(P!=W){if(++K[P]>=V){K[P++]=1}else{break}}}while(P!=W)}}return 0}function m(){var K,L;for(K=0;K!=x;K++){e[K].set(0)}L=l();for(K in L){e[L[K]].set(1)}c();F();if(!b()||!I()){z(u,"Balance is not found")}else{h()}}function c(){var M,N,L,K,O;for(N in A){L=A[N];K=L.dstCol;e[K].set(0);for(M in L.refs){O=L.refs[M];e[K].addi(O.k.mulx(e[O.srcCol]))}}}function F(){var P=0,R=1,O,S,N,M=[],L=0,K,Q=2;for(;P<x;P++){O=e[P].y;S=o(R,O);N=R*O/S;R=Math.max(R,N)}for(P=0;P!=x;P++){K=e[P];N=R/K.y;M[P]=K.x*N;L=Math.max(L,M[P])}while(Q<=L){P=0;while(P!=x&&(M[P]%Q==0)){P++}if(P!=x){Q++;continue}L/=Q;for(P=0;P!=x;P++){M[P]/=Q}}for(P=0;P!=x;P++){e[P].set(M[P])}}function b(){var L,K;for(L=0;L!=x;L++){K=e[L];if(K.x<=0){return 0}}return 1}function I(){var P={},K,L,Q,M,O,N;for(K=0;K!=x;K++){M=g[K];O=B(ElemListMaker.create(M));for(L in O){N=O[L];if(M.part!=0){N=-N}N*=e[K].x;if(!P[L]){P[L]=N}else{P[L]+=N}}}for(L in P){if(P[L]!=0){return 0}}return 1}function h(){z(D,"Ok");for(var K=0;K!=x;K++){g[K].setKoeff(e[K].x)}}function t(M,L,Q){var N,P=J[M],K=P[Q].negx().divi(P[L]),O=new E(L);O.refs.push(new H(Q,K));A.unshift(O);J.splice(M,1);for(N in J){P=J[N];P[Q].addi(P[L].mulx(K));P[L].set(0)}}if(d){this.init(d)}};